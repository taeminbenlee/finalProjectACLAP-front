<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ACLAP</title>

<!-- jquary -->
<script src="http://code.jquery.com/jquery-3.5.1.min.js"></script>

<!-- https://github.com/josecebe/twbs-pagination 에서 가져옴 -->
<script type="text/javascript" src="../js/jquery.twbsPagination.min.js"></script>  

<!-- bootstrap -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>


<!-- icon -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="../fontawesome-free-5.15.3-web/css/all.css" rel="stylesheet">

<!-- mypage CSS -->
<link rel="stylesheet" href="../css/mypage.css">
<link rel="stylesheet" href="../css/navibar.css">
<link href='../fullcalendar/main.css' rel='stylesheet' />

<!-- js -->
<script src='../filesaver/FileSaver.js'></script>
<script src='../filesaver/html2canvas.js'></script>
<script src='../fullcalendar/main.js'></script>
<!-- iamport -->
<script src="https://cdn.iamport.kr/js/iamport.payment-1.1.5.js" type="text/javascript"></script>


<script>

///////////////////////////// 정보 수정 (회원정보 확인)  /////////////////////////

$(document).ready(function(){
	let login = sessionStorage.getItem("login");
	let json = JSON.parse(login); // String -> json

	// 회원정보 확인 Modal
	$("#a_infoUpdate").on("click", function() {
		$("#memberUpdateCheck").modal('show');
	});

	// 비밀번호로 인증하기
	$("#memberUpdatePwdCheckBtn").click(function(){
		if($("#memberUpdatePwdCheckInput").val() == json.pwd ){
			alert("인증되었습니다.");
			$("#memberUpdateCheck").modal('hide');
			$("#memberUpdateModal").modal('show');
		} 
		else {
			alert('비밀번호가 올바르지 않습니다');
			$("#memberUpdatePwdCheckInput").val("");
			$("#memberUpdatePwdCheckInput").focus();
		} 
	});

	// 이메일로 인증하기
	$("#memberUpdateEmailSendBtn").click(function(){
		
		if($("#memberUpdateEmailCheckInput").val() == json.email){
			emailSend();
			alert('인증번호를 보냈습니다. 인증번호를 입력해주세요');
		}
		else{
			alert('이메일 주소가 올바르지 않습니다. 다시 확인하세요');
			$("#memberUpdateEmailCheckInput").val("");
			$("#memberUpdateEmailCheckInput").focus();
		}
	});


	// 이메일 인증번호 전송
	let code = 0;
	function emailSend(){

		let makeNum = Math.floor(Math.random() * 100000) + 100000;
		if(makeNum > 100000) 
			makeNum = makeNum - 10000; 
		code = makeNum
	 
		$.ajax({
			url:"http://192.168.0.230:3000/emailSend",
			type:'post',
			data:{email:json.email, num:code},
			error:function(){
				alert('emailSend ajax error');
			}
		});
	}

	// 이메일 인증번호 확인
	$("#memberUpdateCodeCheckBtn").click(function(){
		if($("#memberUpdateEmailCodeInput").val() == code){
			alert("인증되었습니다.");
			$("#memberUpdateCheck").modal('hide');
			$("#memberUpdateModal").modal('show');
		}
		else{
			alert('인증번호가 올바르지 않습니다');
		}
		$("#memberUpdateEmailCheckInput").val("");
		$("#memberUpdateEmailCheckInput").focus();
		$("#memberUpdateEmailCodeInput").val("");
	});


	/////////////////////////// 정보 수정 (회원정보 수정)  ///////////////////////////////
    
	// 회원정보 수정 초기화 값 넣기 
	$(document).ready(function(){
		$("#newprofile").attr('src', json.profilePic);
		$("#_oldProfilePic").val(json.profilePic);
		$("#_memNum").val(json.memNum);
		$("#newUserName").val(json.userName);
		$("#newNickName").val(json.nickName);
		$("#originalEmail").val(json.email);
		$("#newPwd").val(json.pwd);
		$("#newCpwd").val(json.pwd);
		$("#newPhoneNum").val(json.phoneNum);
	});

	// 프로필 이미지 미리보기
	$("#_profilePic").on("change", handleImgFileSelect);
	function handleImgFileSelect(e) {
		
		let files = e.target.files;
		let filesArr = Array.prototype.slice.call(files);
		filesArr.forEach(function(f) {
		   if(!f.type.match("image.*")) {
		       alert("이미지만 업로드 가능합니다.");
		       return;
		   }
		   sel_file = f;
		   let reader = new FileReader();
		   reader.onload = function(e) {
		        $("#newprofile").attr("src", e.target.result);   
		   }
		   reader.readAsDataURL(f);
		});
	}


	// 회원정보 수정 입력 값 빈 칸 체크
	$("#memberUpdateBtn").click(function(){
		if($("#newUserName").val() == ""){
			alert('이름을 입력하세요');
			$("#newUserName").focus();
		}
		else if($("#newNickName").val() == ""){
			alert('닉네임을 입력하세요');
			$("#newNickName").focus();
		}
		else if($("#newPwd").val() == ""){
			alert('비밀번호를 입력하세요');
			$("#newPwd").focus();
		}
		else if($("#newPhoneNum").val() == ""){
			alert('전화번호를 입력하세요');
			$("#newPhoneNum").focus();
		}
		else {
			inputCheck();
		}
	});


	// 회원정보 수정 입력 값 중복확인 & 정규식 체크
	function inputCheck(){
		let pwdCheck = /^[a-zA-Z0-9]{4,12}$/; // pwassword 정규식
		let phoneCheck = /^01([0|1|6|7|8|9]?)?([0-9]{3,4})?([0-9]{4})$/; // 휴대전화 정규식
		let nickName = $("#newNickName").val();
		$.ajax({
			url:"http://192.168.0.230:3000/checkNickName", 
			type:'post',
			data:{nickName:nickName},
			success:function( data ){
				if(nickName != json.nickName && data != 0){
					alert("사용중인 닉네임 입니다");
					$("#newNickName").val("");
					$("#newNickName").focus();
				}
				else if($("#newPwd").val() != $("#newCpwd").val()){ 
					alert("비밀번호가 동일하지 않습니다");
					$("#newPwd").val("");
					$("#newPwd").focus();
				}
				else if(!pwdCheck.test($("#newPwd").val())){
					alert("패스워드는 4~12자의 영문 대소문자와 숫자만 가능합니다");
					$("#newPwd").val("");
					$("#newPwd").focus();
				}
				else if(!phoneCheck.test($("#newPhoneNum").val())){
					alert("올바른 전화번호를 입력하세요");
					$("#newPhoneNum").val("");
					$("#newPhoneNum").focus();
				}
				else{
					memberUpdateAf();
				}
			},
			error:function(){
				alert('inputCheck Check ajax error');
			}
		});
	}
		
		
		// 회원정보 수정 AF
		function memberUpdateAf(){
		$.ajax({
			url:"http://192.168.0.230:3000/myPageUserUpdate", 
			type:'post',
			data : new FormData($("#myPageUserUpdate")[0]), 
			enctype : 'multipart/form-data',
			processData : false,
			contentType : false,
			cache : false,
			success:function( data ){
				if(data){
					alert('성공적으로 수정되었습니다');
					let item = JSON.stringify(data);       // json -> string
					sessionStorage.setItem("login", item); // 세션 저장
					location.reload();
				}
				else{
					alert("수정 실패");
				}
			},
			error:function(){
				alert('memberUpdateAf ajax error');
			}
		});
		}
		
		
		// 회원 탈퇴
		$("#memberDropOut").click(function(){
			let dropOut = confirm('정말로 탈퇴 하시겠습니까');
			if(dropOut){
				$.ajax({
					url:"http://192.168.0.230:3000/memberDropOut", 
					type:'post',
					data:{memNum:json.memNum},
					success:function( data ){
						if(data>0){
							alert('성공적으로 탈퇴 되었습니다');
							sessionStorage.clear();
							location.href = "../main/main.html"; 
						}
						else{
							alert('회원 탈퇴 실패');
						}
					},
					error:function(){
						alert('memberDropOut ajax Error')
					}
				});
			}
			else{
				$('#memberUpdateModal').modal('hide');
			}
		});
})

</script>


</head>
<!-- calendar script -->

<body>


<div id="naviBar"></div>

<div class="a_main">
<div class="container border-bottom bg-white mt-1 pt-md-3 pt-2 a_header">
    <div class="a_myinfo">
       
       
    </div>
    <div class="a_navbar">
		<ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation"> <a href="javascript:void(0);" class="nav-link" id="_mySchedules" >S.SCHEDULE</a> </li>
            <li class="nav-item" role="presentation"> <a href="javascript:void(0);" class="nav-link" id="_myClass" >T.SCHEDULE</a> </li>
            <li class="nav-item" role="presentation"> <a href="javascript:void(0);" class="nav-link" id="_myLikeClass" >LIKED CLASS</a> </li>
            <li class="nav-item" role="presentation"> <a href="#" class="nav-link" id="a_infoUpdate">UPDATE PROFILE</a> </li>
        </ul> 	
    </div>
</div>

<div class="tab-content w-100 pt-md-0 mainScreen">
    <div class="tab-pane show active" id="user" role="tabpanel" aria-labelledby="user-tab">
        <div class="container rounded-bottom bg-light">
            <div class="row pl-lg-5 pt-md-0 pt-sm-2 mainView">
            	 <div class="col-md-6 py-md-3 subView1" >
                    <div class="d-flex flex-row justify-content-start align-items-center pt-md-4 pb-md-3 pt-sm-2 border-bottom timeline">
                        <div class="p-md-2 pl-sm-2 mt-sm-1 font-weight-bold">User Timeline</div>
                        <input type="month" id="_date" class="p-md-2 pt-sm-1 p-2 ml-auto border rounded text-muted bg-white"><button type="button" class="btn btn-dark" id="_searchSchedules" >검색</button>
                    </div>
                    <div class="text-secondary">
                    	<span class="a_date"></span>
                    </div>
                    <div class="schdulelist">
	                   
                    </div>            
                </div>
                
                <div class="col-md-6 pt-md-0 mt-5 subView2" >
                    <div class="mt-lg-0 mt-md-4" > <b>Detail View</b> </div>
                    <div class="bg-white border rounded view">
                        <div class="d-flex flex-row align-items-center b_info">
                            <div class="d-flex flex-column align-items-center px-md-4 px-3 day">
                                <div class="dday">
                                 
                                </div>
                            </div>

                        </div>
                        <div class="d-flex flex-row justify-content-center ct_info">
                            
                        </div>
                    </div>
                </div>
            	
            </div>
            
            <!-- 선생신분 calendar div -->
            <div class="row pl-lg-5 pt-md-0 pt-sm-2 mainView2">
            	 <div class="col-md-6 py-md-3 subView1" >
                    <div class="d-flex flex-row justify-content-start align-items-center pt-md-4 pb-md-3 pt-sm-2 border-bottom timeline">
                        <div class="p-md-2 pl-sm-2 mt-sm-1 font-weight-bold">My Class Info</div>
                        
                    </div>
                    <div class="text-secondary">
                    	<span class="a_date"></span>
                    </div>
                    <div class="schdulelist2">
	                   
                    </div>            
                </div>
                
                <div class="col-md-6 pt-md-0 mt-5 subView2" >
                    <div class="memListView" > 
                    	<b>Detail View</b> 
                    	<input type="month" id="_date2" class="memListDate"><button type="button" class="btn btn-dark" id="_searchMemList" >검색</button>             	
                    </div>
                    <div class="bg-white border rounded view2">
                        <div class="align-items-center b_info2">
                            <table class="pppInfoTable" style="width: 100%; text-align: center;">
                            <colgroup>
                            <col style="width: 20%; height: 60px;"><col style="width: 60%; height: 60px;"><col style="width: 20%; height: 60px;">
                            
                            </colgroup>	
                            	<thead>
                            	<tr class="classMemTi">
                            		<th>수강일자</th><th>신청자 정보</th><th>신청 인원</th>
                            	</tr>
                            	</thead>
                            	
                            </table>
                        </div>
                        
                    </div>
                </div>
            	
            </div>
            <br><br>
			<div id='calendar' style="position : relative;"></div> 
			
			<!-- Like Class View -->   
			<div id='_myLikeClassView'>
				<table class='MLC_table' id="_MLC_table">
					<tr class='MLC_tr'>
						<th class='MLC_teacher'>TEACHER</th>
						<th class='MLC_title'>TITLE</th>
						<th class='MLC_category'>CATEGORY</th>
						<th class='MLC_grade'>GRADE</th>
						<th class='MLC_point'>POINT</th>
					</tr>	
				</table>
				<br><br>
				<div class="container navStyle">
					<nav aria-lable="Page navigation">
						<ul class="pagination" id="pagination2" style="justify-content:center;"></ul>
					</nav>
				</div>
				
			</div>
        </div>
    </div>	    
</div>

</div>

<!-- <div id="stampTable" class="hide_table"> -->
<div class="modal fade" id="stampTable">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="stamp_Modal_Table">
				<div class="text-right"> <i class="fa fa-times close" data-dismiss="modal"></i> </div>
				<div>
				<table class="stamp_Table" frame=void border="1">
					<colgroup>
					    <col width="20%"/>
					    <col width="20%"/>
					    <col width="20%"/>
					    <col width="20%"/>
					    <col width="20%"/>
					  </colgroup>
				</table>
				</div>
				<!-- paging -->
				<div class="container">
					<nav aria-lable="Page navigation">
						<ul class="pagination" id="pagination" style="justify-content:center;"></ul>
					</nav>
				</div>
				
			</div>
		</div>
	</div>
</div>

<div class="modal fade" id="reciptModal" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body" >
                <div class="text-right"> <i class="fa fa-times close" data-dismiss="modal"></i> </div>
                <div class="px-4 py-5" id="saveRecipt">
                <div class="logoO">
                    <h2 class="aclap">ACLAP</h2>
					<h2 class="aclap">ACLAP</h2>
				</div>
                    <h5 class="mt-5 theme-color mb-5">수업에 참여해 주셔서 감사합니다.</h5> 
                    <span class="theme-coloid="classD"r">결제 내역</span>
                    <div class="mb-3">
                        <hr class="new1">
                    </div>
                    <div class="d-flex justify-content-between"> 
	                    <span class="font-weight-bold">title</span>   
	                    <span class="text-muted" id="classTitle"></span>
                    </div>
                    
                     <div class="mb-3">
                        <hr class="new1">
                    </div>
                    
                    <div class="d-flex justify-content-between"> 
	                    <span class="text-muted" >결제일</span> 
	                    <span class="text-muted" id="payDate"></span>
                    </div>
                    
                     <div class="mb-3">
                        <hr class="new1">
                    </div>
                    
                    <div class="d-flex justify-content-between"> 
	                    <span class="text-muted" >수강일</span> 
	                    <span class="text-muted" id="classDate"></span>
                  	</div>
                    <div class="mb-3">
                        <hr class="new1">
                    </div>
                    <div class="d-flex justify-content-between mt-3"> 
	                    <span class="font-weight-bold">전체 금액</span> 
	                    <span class="font-weight-bold theme-color" id="rPoint"></span> 
                    </div>
                    <div class="text-center mt-5"> <button class="btn btn-primary" id="_saveRecipt">영수증 저장</button> </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- 회원정보수정 Modal 1 (회원정보확인) -->
<div class="modal fade" id="memberUpdateCheck">
  <div class="modal-dialog">
     <div class="modal-content">
       <div class="modal-header">
         <h4 class="modal-title  text-center">회원정보 수정</h4>
       </div>        
       <div class="modal-footer">
         <input type='password' id="memberUpdatePwdCheckInput" class="form-inline" size='45px' style='float:left;' placeholder="비밀번호로 인증하기">
         <button type="button" class="btn btn-light" id='memberUpdatePwdCheckBtn'>인증</button>
       </div>       
       <div class="modal-footer">
         <input type='text' id="memberUpdateEmailCheckInput" class="form-inline" size='45px' style='float:left;' placeholder="이메일로 인증하기 ">
         <button type="button" class="btn btn-light" id='memberUpdateEmailSendBtn'>전송</button>
         <input type='text' id="memberUpdateEmailCodeInput" class="form-inline" size='45px' style='float:left;' placeholder="인증번호 입력">
         <button type="button" class="btn btn-light" id='memberUpdateCodeCheckBtn'>인증</button>
       </div>
     </div>
   </div>
</div>


<!-- 회원정보수정 Modal 2 (정보 입력 View) -->
<div class="modal fade" id="memberUpdateModal">
  <div class="modal-dialog">
     <div class="modal-content">
       <div class="modal-header">
         <h4 class="modal-title">회원정보 수정</h4>
       </div>        
       <div class="modal-body">
       
       <form id='myPageUserUpdate'>
        <input type='hidden' name='memNum' id='_memNum'>
        <input type='hidden' name='oldProfilePic' id='_oldProfilePic'>
       
       	<label for="profile" class='updateFont'>Profile</label> 
       	<br style='padding-bottom:1px'>
	   	<input type="file" name="fileload" class="profile2" id="_profilePic" style="display: none" >	            
	    <label for="_profilePic"> 
	   	<img id="newprofile" class="profile">
	    </label>
	    <br>        
	    
        <label class='updateFont'>UserName</label>
        <input type='text' class="form-inline newInput" name='userName' id='newUserName' size='60px'>
         
       	<label class='updateFont'>NickName</label>
        <input type='text' class="form-inline newInput" name='nickName' id='newNickName' size='60px'>
                 
       	<label class='updateFont'>Email</label>
        <input type='text' class="form-inline holdInput" name='email' id='originalEmail' size='60px' readonly>
  
       	<label class='updateFont'>Password</label>
        <input type='password' class="form-inline newInput" name='pwd' id='newPwd' size='60px'>
         
        <label class='updateFont'>Confirm Password</label>
        <input type='password' class="form-inline newInput" id='newCpwd' size='60px'>
         
        <label class='updateFont'>Phone Number</label>
        <input type='text' class="form-inline newInput" name='phoneNum' id='newPhoneNum' size='60px'>
        
        <br>
        <input type='button' class='btn btn-light' id='memberUpdateBtn' style='float:right' value='수정완료'>
        <input type='button' class='btn btn-light' id='memberDropOut' style='float:right' value='회원탈퇴'>
       </form>
       </div>
     </div>
   </div>
</div>
<div id="footer"></div>

<!-- 일정취소 모달 HTML -->
<div id="cancleScheduleMoal" class="modal fade">
	<div class="modal-dialog modal-confirm">
		<div class="modal-content">
			<div class="modal-header flex-column">
				<div class="canclelogo">
					<h2 class="canclelogoAclap" onclick="ACLAP();return false;">ACLAP</h2>
					<h2 class="canclelogoAclap" onclick="ACLAP();return false;">ACLAP</h2>
				</div>					
				<h4 class="modal-title w-100">정말 일정 취소를 하시겠습니까?</h4>	
			</div>
			<div class="modal-footer justify-content-center">
				<button type="button" class="btn btn-secondary" id="cancleYES">YES</button>
				<button type="button" class="btn btn-danger" id="cancleNO" data-dismiss="modal">NO</button>
			</div>
		</div>
	</div>
</div>

<!-- 다시 신청 모달 HTML -->
<div id="reAddScheduleMoal" class="modal fade">
	<div class="modal-dialog modal-confirm">
		<div class="modal-content">
			<div class="modal-header flex-column">
				<div class="canclelogo">
					<h2 class="canclelogoAclap" onclick="ACLAP();return false;">ACLAP</h2>
					<h2 class="canclelogoAclap" onclick="ACLAP();return false;">ACLAP</h2>
				</div>					
				<h4 class="modal-title w-100">신청을 위해 해당 수업으로<br>이동하시겠습니까?</h4>	
			</div>
			<div class="modal-footer justify-content-center">
				<button type="button" class="btn btn-secondary" id="reAddYES">YES</button>
				<button type="button" class="btn btn-danger" id="reAddNO" data-dismiss="modal">NO</button>
			</div>
		</div>
	</div>
</div>

<!-- 다시 신청 모달 HTML -->
<div id="tScheduleModal" class="modal fade">
	<div class="modal-dialog modal-confirm">
		<div class="modal-content">
			<div class="modal-header flex-column">
				<div class="canclelogo">
					<h2 class="canclelogoAclap" onclick="ACLAP();return false;">ACLAP</h2>
					<h2 class="canclelogoAclap" onclick="ACLAP();return false;">ACLAP</h2>
				</div>					
				<h4 class="modal-title w-100" id="modalContent">신청을 위해 해당 수업으로<br>이동하시겠습니까?</h4>	
			</div>
			<div class="modal-footer justify-content-center">
				<button type="button" class="btn btn-secondary btn_yes" id="">YES</button>
				<button type="button" class="btn btn-danger" data-dismiss="modal">NO</button>
			</div>
		</div>
	</div>
</div>


<script type="text/javascript">
$("#naviBar").load("../navibar.html");
$("#footer").load("../footer.html");

$(document).ready(function() {
 	let login = sessionStorage.getItem("login");
	let json = JSON.parse(login); // String -> json 
	//alert(json.id);
	let memNum = json.memNum;

	// mypage 접속시 div append
	$.ajax({
		url:"http://192.168.0.230:3000/myinfo", 
		type:'post',
		data:{memNum:memNum},
		success:function( dto ){
		
			// calendar을 숨김
			$("#calendar").hide();
			
			$("#_myinfo").remove();	// class 갱신을 위해 이미 있는 class 내용을 비워준다.
			
			// 나의 정보 
			let div = "<div class='profilePic'>"
						+ "<img src='" + dto.profilePic + "' class='myPageProfile' id='profile'>"
					+ "</div>";
		  	
		    div += "<div class='' id='info'>"
		              + "<h2>"+dto.nickName+"님, 환영합니다.</h2>"
		         + "</div>";   
		     
		    // 신청한 수업, 수강한 수업, 포인트    
			div += "<div class='rounded p-lg-2 p-1' id='blue-background'>"
					+ "<div class='point'>"
					
						+ "<div class='d-flex flex-column align-items-center spoint1' id='border-right'>"
							+ "<p class='h4'>" + dto.rCount + "</p>"
							+ "<div class='text-muted' id='count'>신청한 수업</div>"
						+ "</div>"
						
						+ "<div class='d-flex flex-column align-items-center spoint2' onclick='spoint2()' id='border-right'>"
							
							+ "<p class='h4'>" + dto.aCount + "</p>"
							+ "<div class='text-muted' id='count'>수강한 수업</div>"
							
						+ "</div>"
						
						+ "<div class='d-flex flex-column align-items-center spoint3'>"
							+ "<p class='h4'>" + comma(dto.myPoint) + "</p>"
							+ "<div class='text-muted' id='count'>포인트</div>"
						+ "</div>"
				
					+ "</div>"
				+ "</div>";
				
			// alert(div);
			$(".a_myinfo").append(div);
			
		},
		error:function(){
			alert('error');
		}
	});
	
	// 처음 mypage 접속시 현재날로 검색 하기 위함
	let date = new Date();
	let syear = date.getFullYear();
	let smonth = date.getMonth() + 1;
	let sday = date.getDate();
	
	// 처음 mypage 들어올 경우 현재 달로 검색
	getMySchedule(syear, smonth);
	
	//---------------------------------------여기가 학생신분 내용 뿌려주는 부분---------------------------------------------//
	// 자신이 신청한 수업 Schedule을 위한 function
	function getMySchedule(syear, smonth){
		let mdate = syear + "-" +two(smonth + "");
		
		$(".mainView2").hide();
		$("#_date").val(mdate);
		$("#_date2").val(mdate);
		
		$.ajax({
			url:"http://192.168.0.230:3000/mySchedule", 
			type:'post',
			data:{rdate:mdate, memNum:memNum},
			async:false,
			success:function( list ){
			//	alert(list);
				// 스케줄에서 수업이 현재날 기준으로 끝난 수업인지 아닌지 판별하기 위한 date
				
				$(".line").remove();
				$(".a_date").remove();
				
				$(".a_date").append(mdate + "");
				
				str1 = "";
				if(list == ""){
				//	alert("이달에 일정이 없습니다.");
					str1 +=	"<div class='d-flex flex-row pt-2 line'>"
								+ "이달에 일정이 없습니다"
						  + "</div>";
				}else{
					
					$.each(list, function (i, val){
						let pdate = new Date();
						let pyear = date.getFullYear();
						let pmonth = date.getMonth() + 1;
						let pday = date.getDate();
						
						let className = val.title;
			            if(className.length > 17){
			                 className = className.substring(0,15)+"...";
			            }
			            
						pdate = Number(pyear + two(pmonth + "") + two(pday+""));
						
						let rdate = Number(val.rdate.replace(/-/gi, ""));
						
						let cStatus = "";
						if(pdate <= rdate){
							cStatus = "<span class='text-primary a_cStatus'>expect</span>";
						}else{
							cStatus = "<span class='text-danger a_cStatus'>end</span>";
						}
						
						if(val.del == 1){
							cStatus = "<span class='text-danger a_cStatus'>cancle</span>";
						}
						
						str1 += "<div class='d-flex flex-row pt-2 line'>"
									+ "<div class='d-flex flex-column mdot'>"
										+ "<div>" + val.rdate + "</div>"
									+ "</div>"
									+ "<div class='progress vertical-progress'>"
										+ "<div class='_dot' id='dot'></div>"
									+ "</div>"
									+ "<div class='d-flex flex-column border bg-white ml-md-5 p-sm-0 status' id='status' rdate='" + val.rdate + "' class_seq='"+ val.classNum +"' classDel='" + val.del + "'>"
										+ "<div class='_arrow' id='arrow'></div>"
										
										+ "<div class='text-dark pl-sm-2 _title'>" + className 
											+ cStatus
										+ "</div>"
															
									+ "</div>"
							  + "</div>";
					});
				}
				$(".schdulelist").append(str1);
				
			},
			error:function(){
				alert('error');
			}
		});
		
		// 클레스 디테일을 바꿔주는 부분
	 	$(".status").on("click", function() {
			let classNum = $(this).attr("class_seq"); // 클릭한 classNum 가져옴
			let rdate = $(this).attr("rdate"); // 클릭한 rdate 가져옴  ex) 2021-05-22
			let classDel = $(this).attr("classDel"); // 클릭한 스케줄이 삭제되었는지 유무
			
			$.ajax({
				url:"http://192.168.0.230:3000/classDtail", 
				type:'post',
				data:{classNum:classNum},
				async:false,
				success:function( classDto ){
					let month = rdate.substring(5,7);
					let day = rdate.substring(8,10);
					
					$(".dday").remove();
					$(".m_info").remove();
					$(".mct_info").remove();
					
					$(".day").append("<div class='dday'><h5>" + month + "-" + day + "</h5></div>");
					
					let b_info = "<div class='d-flex flex-row align-items-center m_info'>"
									+ "<div class='pr-sm-2 pr-1 a_masterPic'> <img src='" + classDto.profilePic + "' alt='' width='50' height='50' class='myPageProfile'> </div>"
									+ "<div class='d-flex flex-column tps'>"
										+ "<div style='width:220px'><b>" + classDto.title + "</b></div>"
										//+ "<div id='small-font'>" + classDto.primaryCategory + "-"  + classDto.secondaryCategory + "</div>"
										+ "<div id='small-font'>" + classDto.primaryCategory + classDto.secondaryCategory.replace(/\#/g, '-') + "</div>"
									+ "</div>"
							   + "</div>";
							   
	             	$(".b_info").append(b_info);
	  				
	             	classBtn = ""
	             	if(classDel == 1){
	             		classBtn += "<button type='button' class='btn a_btn_participate' style='margin-left: 80px;' classNum='" + classNum + "' >다시 신청</button>"
	             	}else{
	             		classBtn += "<button type='button' class='btn a_btn_recipt' id='border-right'>결제 내역</button>"
	             				  + "<button type='button' class='btn a_btn_cancel' id='_btn_cancel'>일정 취소</button>"
	             	}
	             	let ct_info = "<div class='d-flex flex-column justify-content-center mct_info'>"
	             					+ "<div class='pb-2'><span class='fa fa-book-reader' style='margin-right: 10px'></span><b>선생 소개</b></div>"
	             					+ "<div class='d-flex flex-row align-items-center rounded border mct_box'>"
		           						+ "<div class='aboutMe' id='small-font'>" + classDto.aboutMe + "</div>"
		             				+ "</div>"
		             				
	             					+ "<div class='pb-2 pt-2'><span class='fa fa-chalkboard-teacher' style='margin-right: 10px'></span><b>수업 소개</b></div>"
	             					+ "<div class='d-flex flex-row align-items-center rounded border mct_box'>"
		          						+ "<div class='classInfo' id='small-font'>" + classDto.information + "</div>"    
		          					+ "</div>"
		          					
		          					+ "<div class='btn_sdel'>"
		          						+ classBtn;
	                        	 	+ "</div>"
	             				+ "</div>";	
	             
	             	$(".ct_info").append(ct_info);
	             	
					let classDtail = "";
					
					$(".a_btn_recipt").on("click", function(){
						let classDate =rdate;
						let memNum = json.memNum;
						
						getReceiptData(classDate, classNum, memNum);
					});
					
					
					$("#_btn_cancel").on("click", function(){
						let pdate = new Date();
						let pyear = date.getFullYear();
						let pmonth = date.getMonth() + 1;
						let pday = date.getDate();
						
						pdate = pyear + "-" + two(pmonth + "") + "-" + two(pday+"");
						
						let newRdate = new Date(rdate);
						let newPdate = new Date(pdate);
						
						let r_mDate = dateDiff(newRdate, newPdate);
						
						if(r_mDate <= 2){ // 3으로 바꿔야함!!!!!!!
							alert("죄송합니다.\n\n 2일전에는 취소가 불가능 하므로 관리자에게 문의 바랍니다.");
							return;
						}else{
							$("#cancleYES").attr('classNum', classNum);
							$("#cancleYES").attr('rdate', rdate);
							$("#cancleYES").attr('price', classDto.price);
							
							$("#cancleScheduleMoal").modal('show');
							// myFunc(classNum, rdate, classDto.price);
						}
						
					});
					
					$(".a_btn_participate").on("click", function () {
						$("#reAddYES").attr('classNum', classNum);
						
						$("#reAddScheduleMoal").modal('show');
						
						/*    
						if(test){
							   location.href='../onedayClassView/onedayClassDetail.html?seq='+classNum;
						   }
						   else{
							   
						   } */
					});
				},
				error:function(){
					alert('error');
				}
			});
		});
		
	}
	
	function getReceiptData(classDate, classNum, memNum) {
		$.ajax({
			url:"http://192.168.0.230:3000/getReceiptData", 
			type:'post',
			data:{classDate:classDate, classNum:classNum, memNum:memNum},
			success:function( receipt ){
				// alert(receiept.classDate);
				$('#classTitle').text(receipt.title);
				$("#payDate").text((receipt.payDate).substring(0,10));
				$("#classDate").text((receipt.classDate).substring(0,10));
				$("#rPoint").text(comma(receipt.rPoint) + " point");
				$("#reciptModal").modal('show');
			},
			error:function(){
				alert("error");
			}
		});
	}
	// 달을 검색했을 경우
	$("#_searchSchedules").click(function() {
		let date = $("#_date").val();

		let year = date.substring(0, 4);
		let month = date.substring(5,8);

		// 자신이 신청한 수업 Schedule을 위한 function
		getMySchedule(year, month);
	});
	
	
	// 나의 일정
	$("#_mySchedules").on("click", function() {
		// 기존 학생신분 부분을 보여줌
		$(".mainView").show();
		$(".mainView2").hide();
		$('#_mySchedules').css('color', 'blue');
		$('#_myClass').css('color', 'black');
		$('#_myLikeClass').css('color', 'black');
		getMySchedule(syear, smonth)
		// calendar을 숨김
		$("#calendar").hide();	
		$("#_myLikeClassView").hide();
	});
	
	/////////////////////////// 자신이 개설한 수업  ///////////////////////////////
		
	// 선생 신분 클릭 시
	/* $("#_myClass").on("click", function() {	
		// 기존 학생신분 부분을 숨김
		$(".mainView").hide();
		$('#_myClass').css('color', 'green');
	
		$("#calendar").show();
		

	}); */
	// 영수증 이미지 저장 script
	$("#_saveRecipt").on("click", function() {
		html2canvas($("#saveRecipt").get(0)).then(
		canvas =>{
			canvas.toBlob(function(data){
				saveAs(data, 'image.png');
			});
		});
	}); 
	

	
	function two(msg){
		return msg.length<2?"0"+msg:msg; // 글자수가 2보다 작을때 0을 붙여서 반환한다.
	};
	
	
	// 두개의 날짜를 비교하여 차이를 알려준다.
	function dateDiff(_date1, _date2) {
	    let diffDate_1 = _date1 instanceof Date ? _date1 :new Date(_date1);
	    let diffDate_2 = _date2 instanceof Date ? _date2 :new Date(_date2);
	 
	    diffDate_1 =new Date(diffDate_1.getFullYear(), diffDate_1.getMonth()+1, diffDate_1.getDate());
	    diffDate_2 =new Date(diffDate_2.getFullYear(), diffDate_2.getMonth()+1, diffDate_2.getDate());
	 
	    let diff = Math.abs(diffDate_2.getTime() - diffDate_1.getTime());
	    diff = Math.ceil(diff / (1000 * 3600 * 24));
	 
	    return diff;
	}
	
	function comma(num){
	    let len, point, str; 
	       
	    num = num + ""; 
	    point = num.length % 3 ;
	    len = num.length; 
	   
	    str = num.substring(0, point); 
	    while (point < len) { 
	        if (str != "") str += ","; 
	        str += num.substring(point, point + 3); 
	        point += 3; 
	    } 
	     
	    return str;
	}
	
	
	// function myFunc(classNum, classDate, price){
	$("#cancleYES").on("click", function(){	
		let classNum = $(this).attr("classNum");
		let classDate = $(this).attr("rdate");
		let price = $(this).attr("price");
   
		$.ajax({
			url:"http://192.168.0.230:3000/cancelSchedule", 			
			type:"post",
			data:{memNum:memNum, classNum:classNum, classDate:classDate, rPoint:price},
			success:function( count ){
				alert('success');
				location.reload(true);
			},
			error:function(){
				alert('error');
			}
		}); 
	})
	
	$("#reAddYES").on('click', function(){
		let classNum = $(this).attr("classNum");
		
		location.href='../onedayClassView/onedayClassDetail.html?seq='+classNum;
	});
	
	
	function comma(num){
	    let len, point, str; 
	       
	    num = num + ""; 
	    point = num.length % 3 ;
	    len = num.length; 
	   
	    str = num.substring(0, point); 
	    while (point < len) { 
	        if (str != "") str += ","; 
	        str += num.substring(point, point + 3); 
	        point += 3; 
	    } 
	     
	    return str;
	}
});


function spoint2(){
	let login = sessionStorage.getItem("login");
	let json = JSON.parse(login); // String -> json 
	//alert(json.id);
	let memNum = json.memNum;
	
	stampTable(memNum, 0);
	stampCount(memNum);
}

// 도장판을 보기위한 function
function stampTable( memNum, pageNum ){
	// $(".hide_table").attr('class', "show_table");
	
	$.ajax({
		url: 'http://192.168.0.230:3000/myStampList',
		type: 'POST',
		dataType: 'json',
		data: {memNum:memNum, pageNum:pageNum},
		success: function(list) {
	
			$(".stamp_Table_body").remove();
			
			let table = "<tbody class='stamp_Table_body'><tr style='height:50%;'>";
			
			// 다 채워진 판 이외에 나머지 도장판
			let i = 1;
			for(i; i < list.length + 1; i++){
				let stampPriCate = list[i-1].primaryCategory;
				let priCate = "";
	
				if(stampPriCate == '외국어'){
					priCate += "<i class='fas fa-language' style='font-size:50px;color:#1E3269;'></i>";
				}else if(stampPriCate == '크리에이티브'){
					priCate += "<i class='fas fa-palette' style='font-size:50px;color: #1E3269;'></i>";
				}else if(stampPriCate == '요리'){
					priCate += "<i class='fas fa-utensils' style='font-size:50px;color: #1E3269;'></i>";
				}else if(stampPriCate == '프로그래밍'){
					priCate += "<i class='fas fa-code' style='font-size:50px;color: #1E3269;'></i>";
				}else if(stampPriCate == '스포츠레저'){
					priCate += "<i class='fas fa-dumbbell' style='font-size:50px;color: #1E3269;'></i>";
				}
				if(i==6){
					table += "</tr><tr>";
				}
				table += "<td>" + priCate + "</td>";
			}
			
			for(i; i<11; i++){
				if(i==6){
					table += "</tr><tr>";
				}
				table += "<td>"+ i +"</td>";
				
			}
			
			table += "</tr></tbody>";
			// alert(table);
			
			$(".stamp_Table").append(table);
         	
			$("#stampTable").modal('show');
		},
		error: function () {
			alert('error');
		}
	});
}

//도장의 총수를 취득
function stampCount(memNum) {
	
	$.ajax({
		url:"http://192.168.0.230:3000/stampCount",
		type:"get",
		data:{memNum:memNum},
		success:function( totalCount ){
		
			if(totalCount == 0){
				totalCount = 1;	
			}
			loadPage(memNum, totalCount);
		},
		error:function(){
			alert('error');
		}
	});
}

//paging 처리
function loadPage( memNum, totalCount  ) {
	
	let pageSize = 10;
	let nowPage = 1;
	
	let _totalPages = totalCount / pageSize;
	if(totalCount % pageSize >0){
		_totalPages++;
	}

	$("#pagination").twbsPagination("destroy")
	
	$("#pagination").twbsPagination({		
	//	startPage: 1,
		totalPages: _totalPages,
		visiblePages: 10,
		first:'<span aria-hidden="true">«</span>',
		prev:"이전",
		next:"다음",
		last:'<span aria-hidden="true">»</span>',
		initiateStartPageClick:false, // 맨처음 프로그램을 실행 하였을 경우 onPageClick의 자동실행을 막아준다
		onPageClick:function(event, page){
			nowPage = page;
		//	alert('nowPage:' + page);
			stampTable( memNum, page - 1 );
		}
	});	
	
//	$("#pagination").twbsPagination('changeTotalPages', _totalPages, nowPage);
}


</script>


<script type="text/javascript">	
	$(document).ready(function() {
	// alert('달력달력')
	
	let login = sessionStorage.getItem("login");
	let json = JSON.parse(login); // String -> json
	//alert(json.id);

	/* 	
	$(document).addEventListener('DOMContentLoaded', function() {
		 */
	$("#_myClass").click(function(){
		$(".mainView").hide();
		$("#_myLikeClassView").hide();
		$('#_myClass').css('color', 'blue');
		$('#_mySchedules').css('color', 'black');
		$('#_myLikeClass').css('color', 'black');
		$(".mainView2").show();
		$("#calendar").show();

		let memNum = json.memNum;
		
		

		// alert('hi');
		var calendarEl = document.getElementById('calendar');
		var calendar = new FullCalendar.Calendar(calendarEl, {
		headerToolbar: {	
	        left: 'prev,next today',
	        center: 'title',
	        right: 'dayGridMonth,timeGridWeek,timeGridDay,listMonth'
	      },
	    
	      locale: "ko",
	      navLinks: true, // can click day/week names to navigate views
	      businessHours: true, // display business hours
	      editable: true,
	      selectable: true,
	      displayEventTime: true, //시간은 빼주었다... 하지만 주, 일 별 목록에선 보인다.
			eventSources: [{
			events: function(info, successCallback, failureCallback) {
				$.ajax({
					url: 'http://192.168.0.230:3000/myclsScheduleData',
					type: 'POST',
					dataType: 'json',
					data: {memNum:memNum},
					success: function(data) {
						// alert('success');
						var ev = Array();
						$.each(data, function (i, entry) {
							
						let name = " ("+entry.name+")";
							ev.push({title: entry.title + name,
								
								start: entry.rdate, end:entry.rdate
							});
							
						});
						successCallback(ev);
					},
					error: function () {
						alert('error');
					}
				});
			}
		}]	
	});
			
	calendar.render();
	
	getMyClassList(memNum);
	
	
	
	
	
	
	});	
});	


//내가 개설한 클래스의 모든 목록을 가져온다
function getMyClassList() {
	$.ajax({
		url:"http://192.168.0.230:3000/getMyClassList",
		type:"get",
		data:{masterNum:memNum},
		success:function( list ){
			//alert('success');
			
			$(".line").remove();
			let classInfo = '';

			if( list.length==0){
				classInfo = "<div class='d-flex flex-row pt-2 line'>"
							+ "개설한 클래스 정보가 없습니다"+"</div>";
				$(".schdulelist2").append(classInfo);
				} else {
					
					$.each(list, function (i, val) {
						let oldRegNum = val.oldRegNum;
						let newRegNum = val.newRegNum;
						let bedge = "";
						
						if(oldRegNum != newRegNum){
							bedge = "<span class='classBedge'>!</span>";							
						}else{
							bedge = "<div style='width: 16px;'></div>";
						}
						
						let btn = "";
						if(val.del != 1){
							btn = "<button class='btn btn-danger myClassStop' val='"+val.classNum+"'>중단</button>";
						}else{
							btn = "<button class='btn btn-warning myClassStart' val='"+val.classNum+"'>재개</button>";
						}
						let className = val.title;
			            if(className.length > 15){
			                 className = className.substring(0,15)+"...";
			            } 
						classInfo += "<div class='d-flex flex-row pt-2 line'>"
								+ bedge
								+ "<div>" + val.startDate.substring(0,10) + "<br>" +val.endDate.substring(0,10)+"</div>"
								+ "<div class='progress vertical-progress'>"
								+ "<div class='_dot' id='clsDot'></div>"
								+ "</div>"
								+ "<div class='ufcTitle'><a href='#' class='classDetailClick' val='"+val.classNum+"'>"
								+ "<span class='text-info a_cStatus'>" + className + "(<i class='far fa-thumbs-up'></i>"+val.likeCount+")"
								+ "</span></a><br>"
								+ "<button class='btn btn-success myClassEdit' val='"+val.classNum+"'>수정</button>"
								+ btn
								+ "<button class='btn btn-secondary myClassCheck' val='"+val.classNum+"'>바로가기</button></div>"					
							
					  + "</div>";
								
					});
					
					$(".schdulelist2").append(classInfo);
				}
			
			
		},
		error:function(){
			alert('error');
		}
	});
}	
//내가 개설한 클래스 목록에서 바로가기 클릭시...
$(document).on("click", ".myClassCheck", function () { 
	$("#modalContent").text("해당 클래스로 이동하시겠습니까?");
	$('.btn_yes').attr("id", "myClassCheck");
	let classNum = $(this).attr("val");
	
	$("#myClassCheck").on('click', function(){
		location.href = "../onedayClassView/onedayClassDetail.html?seq="+classNum; 
	});
	
	$("#tScheduleModal").modal('show');
	
	//	alert("클래스로 이동");
	/* 
	let classNum = $(this).attr("val");
	location.href = "../onedayClassView/onedayClassDetail.html?seq="+classNum; 
	*/
});


//내가 개설한 클래스 목록에서 수정 클릭시...
$(document).on("click", ".myClassEdit", function () { 
		$("#modalContent").text("수정 화면으로 이동하시겠습니까?");
		$('.btn_yes').attr("id", "myClassEdit");
		
		let classNum = $(this).attr("val");
		
		$("#myClassEdit").on('click', function(){
			location.href = "../onedayClassView/onedayClassUpdate.html?seq="+classNum;
		});
		
		$("#tScheduleModal").modal('show');
	//	alert("수정");
		/* 
		let classNum = $(this).attr("val");
		location.href = "../onedayClassView/onedayClassUpdate.html?seq="+classNum; 
		*/

});
//내개 개설한 클래스 목록에서 재개 클릭시...
$(document).on("click", ".myClassStart", function(){
	$("#modalContent").html("수업 재개를 위해 수정 화면으로 <br>이동하시겠습니까?");
	$('.btn_yes').attr("id", "myClassStart");
	
	let classNum = $(this).attr("val");
	
	$("#myClassStart").on('click', function(){
		location.href = "../onedayClassView/onedayClassUpdate.html?seq="+classNum;
	});
	
	$("#tScheduleModal").modal('show');
});
//내가 개설한 클래스 목록에서 중단 클릭시...
$(document).on("click", ".myClassStop", function () { 
	$("#modalContent").text("정말 중단 하시겠습니까?");
	$('.btn_yes').attr("id", "myClassStop");
	let classNum = $(this).attr("val");
	
	$("#myClassStop").on('click', function(){
		$.ajax({
			url:"http://192.168.0.230:3000/onedayClassDelete",
			type:"post",
			data:{classNum:classNum},
			success:function( result ){
				if(result)
				alert('성공적으로 중단 되었습니다');
				location.reload();
			},
			error:function(){
				alert('myClassStop ajax error');
			}
		});
	});
	
	$("#tScheduleModal").modal('show');
	/* 
		if(del){
			$.ajax({
				url:"http://192.168.0.230:3000/onedayClassDelete",
				type:"post",
				data:{classNum:classNum},
				success:function( result ){
					if(result)
					alert('성공적으로 중단 되었습니다');
					location.reload();
				},
				error:function(){
					alert('myClassStop ajax error');
				}
			});
		}
 	*/
});
	
//내가 개설한 클래스를 클릭시 디테일부분에 뿌려지는 내 클래스 수강생 신청인 정보 목록
function searchMemList(classNum){	
	let classDate = $("#_date2").val();
	
	$.ajax({
		url:"http://192.168.0.230:3000/getMyClassParticipants",
		type:"get",
		data:{classNum:classNum, classDate:classDate},
		success:function( list ){
			$(".pInfo").remove();
			
			let ppp="<tbody class='pInfo'>";
			if(list.length == 0){
				ppp += "<tr><td colspan='3'>해당 월에는 가입자가 없습니다.</td></tr>";
			}
			else{
				$.each(list, function(i,val){
					/* let month = val.rdate.substring(5,7);
					let day = val.rdate.substring(8,10); */
					ppp += "<tr class='classMemCon'><td class='classMemDate'>"+val.rdate.substring(0,10)+"</td>"
						+ "<td style='padding-left: 80px;'> <div style='float:left'><img src='" + val.profilePic + "' alt='' class='classMemProfile'></div>"
						+ "<div style='float:left'><div class='classMemNic'>" +val.nickName+ "</div><div class='classMemEma'>" + val.email + "</div></div></td><td>"+val.participants+"</td>"
			  			+ "</tr>";
				});
			}
			ppp += "</tbody>";
		$(".pppInfoTable").append(ppp);
		
			
		},
		error:function(){
			alert('error');
		}
	});
}

$(document).on("click", ".classDetailClick", function () {
	let classNum = $(this).attr("val");
	$("#_searchMemList").attr('classNum', classNum);
	
	searchMemList(classNum);
});

$("#_searchMemList").on('click', function(){
	let classNum = $(this).attr("classNum");
	if(classNum == null){
		alert("검색하실 클래스를 선택해주세요.");
		return;
	}
	searchMemList(classNum);
});

</script>

<script>	 
//------- Like Class 처리 ---------
let log = sessionStorage.getItem("login");
let log2 = JSON.parse(log); // String -> json 
let memNum = log2.memNum;

getLikeClass(0); 
getLikeClassCount();
function getLikeClass(pNumber){
	$.ajax({
		url:"http://192.168.0.230:3000/getLikeClassList",  
		type:"post",
		data:{ page:pNumber, memNum:memNum },
		success:function( data ){

			//페이징 클릭 시 이전에 불러온 테이블은 지우고 다시 시작하기 
 			$(".MLC_trContent").remove();			
			                      //index, 변수
			$.each(data, function (i, item) {
				let app = "";
					app = "<tr class='MLC_trContent'>" +
						  	"<td>"+
								"<div style='float:left'>"+
									"<img src=" + item.profilePic +" class='MLC_proFile'>"+ 
								"</div>"+
								"<div style='float:left'>" + 
									"<div class='MLC_nameTxt'>"+ item.instructor +"</div>"+ 
									"<div class='MLC_mailTxt'>"+ item.email +"</div>"+ 
						 		"</div>"+
								"</td>"+
								"<td class='MLC_titleTxt MLC_titleInput' onclick='goLikeClassDetail("+item.classNum+")'>"+ item.title +"</td>"+
								"<td class='MLC_titleTxt ' id='MLC_categoryInput'>"+item.primaryCategory+"</td>"+
								"<td class='MLC_titleTxt'>"+
									"<i class='fas fa-star' style='color: red;'></i>"+
									"<span id='MLC_gradeInput'>"+item.avgPoint+"</span>"+ 
								"</td>"+
								"<td class='MLC_pointTxt'>"+
									"<i class='fas fa-coins'></i>"+
									"<span id='MLC_pointInput'>"+item.price+"</span>"+
								"</td>"+
							"</tr>"					
				$("#_MLC_table").append(app);	
			});		 
		},
		error:function(){
			alert('getLikeClassList ajax error');
		}
	});
}


// 글의 총 수 
function getLikeClassCount(){
	$.ajax({
		url:"http://192.168.0.230:3000/getLikeClassCount",
		type:"post",
		data:{memNum:memNum},
		success:function( count ){
			// alert(count);
			loadPages(count); 
		},
		error:function(){
			alert('getLikeClassCount ajax error');
		}		
	});
}


//페이징 처리 
function loadPages( totalCount ){
	let pageSize = 5;		
	let nowPage = 1;	

	//총 페이지의 수
 	let totalPage = totalCount / pageSize;
	if(totalCount % pageSize > 0){
		totalPage++;
	}

	// 페이지 초기화 : 검색 시 이전 값을 지워주기 위함
	$("#pagination2").twbsPagination('destroy');
	
	//페이지 설정	
	$("#pagination2").twbsPagination({
		totalPages: totalPage,
		visiblePages: pageSize,
		first:'<span sria-hidden="true">«</span>',
		prev:"PREV",
		next:"NEXE",
		last:'<span sria-hidden="true">»</span>',
		initiateStartPageClick:false, // 처음 로드 시 onPageClick 자동 실행되지 않도록
		
		//클릭시 페이지를 바꿔라
		onPageClick:function(event, page){
			nowPage = page;
			getLikeClass(page-1);
		}
	}); 
}

$("#_myLikeClassView").hide();
$("#_myLikeClass").click(function(){
	$("#calendar").hide();
	$(".mainView").hide();
	$(".mainView2").hide();
	$('#_myLikeClass').css('color', 'blue');
	$('#_mySchedules').css('color', 'black');
	$('#_myClass').css('color', 'black');
	
	$("#_myLikeClassView").show();
});


function goLikeClassDetail(seq){
	location.href='../onedayClassView/onedayClassDetail.html?seq='+seq;
}
</script>
</body>
</html>