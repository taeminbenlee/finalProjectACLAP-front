<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ACLAP</title>
<!-- jquary -->
<script src="http://code.jquery.com/jquery-3.5.1.min.js"></script>
<!-- 제이쿼리 ui css -->
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
 <!-- 제이쿼리 style css -->
<!--<link rel="stylesheet" href="/resources/demos/style.css"> -->

<!-- 제이쿼리 ui js -->
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/themes/vader/jquery-ui.css" rel="stylesheet"/>
 
<!-- icon -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<!-- font -->
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

<link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic+Coding&display=swap" rel="stylesheet">

<!-- 클립보드 복사 -->
<script src="../js/clipboard.min.js"></script>

<!-- <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script> -->

<link rel="stylesheet" type="text/css" href="http://netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css">

<!-- 커스텀 css -->
<link rel="stylesheet" href="../css/onedayClassDetail.css">
<!-- 카카오맵 -->
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=92928f9e601c2b81c37ec8882d4901ac&libraries=services"></script>
<!-- bootstrap -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<!-- bar-rating -->
<link rel="stylesheet" href="../css/fontawesome-stars.css">
<script type="text/javascript" src="../js/jquery.barrating.min.js"></script> 

<!-- iamport -->
<script src="https://cdn.iamport.kr/js/iamport.payment-1.1.5.js" type="text/javascript"></script>


<script>
let urlParams = location.search.split(/[?&]/).slice(1).map(function(paramPair) {
    return paramPair.split(/=(.+)?/).slice(0, 2);
}).reduce(function(obj, pairArray) {
    obj[pairArray[0]] = pairArray[1];
    return obj;
}, {});

let seq = urlParams.seq


</script>

</head>
<body>

<div id='naviBar'></div>
<br><br><br>

<button class="goBack" id="_goBack">목록 바로가기</button>

<script>
$("#_goBack").on("click", function(){
	const queryString = window.location.search;
	const urlParams = new URLSearchParams(queryString);
	let priCate = urlParams.get('cate');
	const ssseq = urlParams.get('seq');
	
	if(priCate == null){
		priCate = "";
	}
	window.location.href = "../categoryPage/categoryViewPage.html?seq=" + seq + "&cate="+ priCate +"#comeBack";
});

</script>


<div class='onedayClassContaier'>
	<div class='onedayClassMainTextBox'>
	
		<!-- 상단 제목 -->
		<div class='onedayClassMainText'>
			<i id='pCategory' class="fas fa-language">&nbsp;</i>
		</div>
		<div class='onedayClassTitle'>
			
		</div>
		<div class='onedayClassMainText3'>
			<i class="fas fa-star" style='color: red;'></i>
			<span id='starGrade' style='font-weight: 600;'>
				<span id='starGradeCount' style='font-weight: 300;'></span>
			</span>	
			<span id='DetailLocation'>
				
			</span>
			<span>                            
				<button class='DetailLikeBtn' check="no" onclick='DetailLike()'><i class="fas fa-heart">&nbsp;저장</i></button>
				<button class=DetailShareBtn onclick='DetailShare()'  data-clipboard-text=""><i class="fas fa-share">&nbsp;공유하기</i></button>
			</span>
		</div>
	</div>
	
	
	
	
	
		<!--이미지박스1-->
		<div class='onedayClassImageBoxA'>
			<div style='float:left'>
			   	<div class='ocImgFrameA2'>
				       <img id="_ocImgA2" class="ocImgA2" src="../images/onedayClassImg2.png">
				</div>
			</div>
			
			<div style='float:left'>	
			   	<div class='ocImgFrameA1'>
				       <img id="_ocImgA1" class="ocImgA1" src="../images/onedayClassImg1.png">
				</div>
	
				<div class='ocImgFrameA3'>
					    <img id="_ocImgA3" class="ocImgA3" src="../images/onedayClassImg2.png">
				</div>
			</div> 
			
			<div style='float:left'>
			   	<div class='ocImgFrameA4'>
				       <img id="_ocImgA4" class="ocImgA4" src="../images/onedayClassImg2.png">
				</div>
			</div>
					
			<div style='float:left'>
			   	<div class='ocImgFrameA5'>
				       <img id="_ocImgA5" class="ocImgA5" src="../images/onedayClassImg2.png">
				</div>
			</div>
		</div>
		
		
		<!--이미지 박스 2-->
		<div class='onedayClassImageBoxB'>
			<div style='float:left'>
			   	<div class='ocImgFrameB1'>
				       <img id="_ocImgB1" class="ocImgB1" src="../images/onedayClassImg1.png">
				</div>
			
			   	<div class='ocImgFrameB2'>
				       <img id="_ocImgB2" class="ocImgB2" src="../images/onedayClassImg2.png">
				</div>
			</div>
			 
			<div style='float:left'>
				<div class='ocImgFrameB3'>
					    <img id="_ocImgB3" class="ocImgB3" src="../images/onedayClassImg2.png">
				</div>
			</div>	
				
			<div style='float:left'>	
				<div class='ocImgFrameB4'>
					     <img id="_ocImgB4" class="ocImgB4" src="../images/onedayClassImg2.png">
				</div>
			</div> 
			
			<div style='float:left'>	
				<div class='ocImgFrameB5'>
					      <img id="_ocImgB5" class="ocImgB5" src="../images/onedayClassImg2.png">
				</div>
			</div> 
		</div>
	
		 
		<!--이미지 박스 3  -->
		<div class='onedayClassImageBoxC'>
			<div style='float:left'>
			   	<div class='ocImgFrameC2'>
				       <img id="_ocImgC2" class="ocImgC2" src="../images/onedayClassImg2.png">
				</div>
			
			   	<div class='ocImgFrameC3'>
				       <img id="_ocImgC3" class="ocImgC3" src="../images/onedayClassImg2.png">
				</div>
			</div>
			 
			<div style='float:left'>
				<div class='ocImgFrameC4'>
					    <img id="_ocImgC4" class="ocImgC4" src="../images/onedayClassImg2.png">
				</div>
			</div>	
				
			<div style='float:left'>	
	 		   	<div class='ocImgFrameC1'>
					    <img id="_ocImgC1" class="ocImgC1" src="../images/onedayClassImg1.png">
				</div>
	
	 			<input type="file" name="imageC5" id="_classImgC5" style="display: none">	            
	 			<div class='ocImgFrameC5'>
					 <label for="_classImgC5"> 
					    <img id="_ocImgC5" class="ocImgC5" src="../images/onedayClassImg2.png">
					 </label>
				</div>
			</div> 
		</div>
		<!--/////////////// 모달 들어가는 부분///////////// -->
		
		
		<!-- 이미지 확대 모달 -->
		
		<div class="image_hide_modal">
		
			<i class="fas fa-times"></i>
			<div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
			  <div class="carousel-inner">
			    <div class="carousel-item active">
			      <img src="" id="img1" class="d-block w-100 modalimg" alt="...">
			    </div>
			    <div class="carousel-item">
			      <img src="" id="img2" class="d-block w-100 modalimg" alt="...">
			    </div>
			    <div class="carousel-item">
			      <img src="" id="img3" class="d-block w-100 modalimg" alt="...">
			    </div>
			    <div class="carousel-item">
			      <img src="" id="img4" class="d-block w-100 modalimg" alt="...">
			    </div>
			    <div class="carousel-item">
			      <img src="" id="img5" class="d-block w-100 modalimg" alt="...">
			    </div>
			  </div>
			  <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
			    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
			    <span class="sr-only">Previous</span>
			  </a>
			  <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
			    <span class="carousel-control-next-icon" aria-hidden="true"></span>
			    <span class="sr-only">Next</span>
			  </a>
			</div>
		</div>
		
		
		
		
		
		
		
	<div class='onedayClassContentBox1'>
		<div class='ocSubTitle' id='nickNameTit'></div>
		<i class='material-icons ocIcon'>access_time</i>
		<span class='ocTxt1' id="classTime"></span>
		&nbsp;&nbsp;
		<i class='material-icons'>people</i>
		<span class='ocTxt1' id="classMaxNum"></span>
		&nbsp;&nbsp;
      	<i class='material-icons'>check</i>
      	<span class='ocTxt1' id="classSupplie"></span>
      	<div class='classInfo'>
      		
      	</div>

	</div>
	
	
	<!-- 프로그램 -->
	<div class='hrMargin'><hr></div>
	<div class='ocSubTitle'>프로그램</div>
	<div class='scProgramTxt' id="program" style='padding-top:10px;'>
	
	</div>
	
	<!-- youtube -->
	<div class='hrMargin' id="youTubeLine"><hr></div>
	<div class='ocSubTitle' id="youTubeTitle">YouTube</div>
	 <iframe id="youtubeLink" width="1120" height="630" src="" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
	
	<div class='hrMargin'><hr></div>
	<!-- 선생님 소개 -->
	<img class='ocTeacherImg' id='_ocTeacherImg' src="../images/profileSample.png" style='float:left'>
	<div style='float:left; padding-top:2px; padding-left:10px;'>
		<span class='ocSubTitle' id='teacherTitle'></span><br>
		<span class='ocTeacherMail'></span>
	</div>
	<br><br><br><br>
	<div class='teacherStar'>
		<i class="far fa-thumbs-up"></i>&nbsp;
		<span class='teacherTxt' id='masterLikes'></span> 
		&nbsp;&nbsp;&nbsp;&nbsp;
		<i class="fas fa-chalkboard-teacher"></i>&nbsp;
		<span class='teacherTxt' id="masterClass"></span> 
		
	</div>
	<div class='scProgramTxt' id='TeacherInfo'>
		
	</div>
	<div class='hrMargin'><hr></div>
	
	<!-- 수업 장소 -->
	<span class='ocSubTitle'>수업장소</span><br>
	<div style='margin-top:2px; font-size:15px' id="location"></div>
	<div id="map" style="width:100%;height:450px; border-radius:20px; margin-top:20px;"> </div>		
		 
	<!-- 후기(최신순으로 여섯개?) -->
   	<div class='hrMargin'><hr></div>
	<span class='ocSubTitle' id='teacherTitle'>
		<i class="fas fa-star" style='color: red;'></i>
		<span id='reviewGrade'></span>
	</span><br>
		<div style='padding-top:15px;'>
		<div style='float:left; margin-right:3px; margin-top:2px;'><p class="ratingAvg" id="saAvg"><b>만족도</b></p></div>
		<div style='float:left; margin-right:25px;'>
			<select id="satisfaction" name="satify" background-color="red">	       		
					<option background-color="red"; value="1">1</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5</option>
				</select>
				<div id="saAvg"></div>
		</div>
		
		<div style='float:left; margin-right:3px; margin-top:2px;'><p class="ratingAvg" id="clAvg"><b>청결도</b></p></div>
		<div style='float:left; margin-right:25px;'>
			<select id="clean" name="clean" background-color="red">	       		
					<option background-color="red"; value="1">1</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5</option>
				</select>
			
		</div>
		
		<div style='float:left; margin-right:3px; margin-top:2px'><p class="ratingAvg" id="accAvg"><b>정확성</b></p> </div>
		<div style='float:left; margin-right:25px;'>
			<select id="acc" name="acc" background-color="red">	       		
					<option background-color="red"; value="1">1</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5</option>
				</select>
				
		</div>
		
		<div style='float:left; margin-right:3px; margin-top:2px'><p class="ratingAvg" id="coAvg"><b>의사소통</b><a></a></div>
		<div style='float:left; margin-right:25px;'>
			<select id="communi" name="communi" background-color="red">	       		
					<option background-color="red"; value="1">1</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5</option>
				</select>
				
		</div>
		
		<div style='float:left; margin-right:3px; margin-top:2px'><p class="ratingAvg" id="loAvg"><b>위치성</b></p></div>
		<div style='float:left; margin-right:25px;'>
			<select id="loca" name="loca" background-color="red">	       		
					<option background-color="red"; value="1">1</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5</option>
				</select>
				
		</div>
		</div>
	
		
		<br><br><br>


	
	<!-- 간략후기 -->
	<div class="reviewAppend">
	
	</div>
	<!-- 이 div 살리지마.... -->
	
	<!-- 후기 전체보기 버튼 (리뷰가 여섯개 이상이면 버튼 보이기) -->
	<div align=center>
		<input type='button' class='reviewModalBtn' value='리뷰 전체보기'>
		<!-- 리뷰쓰기 버튼 -->
	<!-- Button trigger modal -->
	<button type="button" class="reviewBtn" data-toggle="modal" data-target="#exampleModal"> <!--  data-toggle="modal" data-target="#exampleModal" -->
	  리뷰쓰기
	</button>
	</div>
	<hr>

	
	
	<!-- 후기 전체보기 Modal -->
	<div class='review_hide_modal'>
		<div class='review_Modal_Container'>
			<i class='far fa-window-close review_modal_close'></i>
			<div class="review_Modal_Content">
			   <!-- 리뷰내용 -->
			   
				<!-- 
				리뷰내용		
				<div class='reviewModalItem'>
					<div style='float:left'>
						<img src="../images/managerIcon.jpg" class='reviewImg'>
					</div>
					<div style='float:left;'>
						<div class='reviewId'>이안근짱</div>
						<div class='reviewDate'>5월 26일</div>
					</div>
					<br><br><br>
					<div class='reviewContent'>
						또 참여하고 싶다능~~~213213213213213213<br>
						크크코쿄쿜콬킼킄
						또 참여하고 싶다능~~~<br>
						크크코쿄쿜콬킼킄
						또 참여하고 싶다능~~~<br>
						크크코쿄쿜콬킼킄
					</div>
				</div> -->
			</div>
		</div>
	</div>
	
	<!-- 후기쓰기  모달-->	
	<!--Review Modal -->
	<div class="modal fade reviewModal" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
	  <div class="modal-dialog modal-lg">
	    <div class="modal-content"> <!-- 크기에맞게 자동 조절 style="max-width: 100%; width: auto; display: table; -->
	      <div class="modal-header">
	        <h4 class="modal-title" id="exampleModalLabel"">Review</h4>
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	          <span aria-hidden="true">&times;</span>
	        </button>
	      </div>
	      <div class="modal-body">
	      		<!-- 별점 자리 -->
	      	<form id="reviewImages" name="reviewImages" method="post" enctype="multipart/form-data">
	      		<input type="hidden" name="memNum" id="memNum" value="">
	      		<input type="hidden" name="name" id="name" value="">
	      		<input type="hidden" name="classNum" id="classNum" value="">
	 <!--      		<input type="hidden" name="reviewSeq" id="reviewSeq" value=""> -->
	      		<span class="reviewTitle"><b>참여하신 클래스는 어떠셨나요?</b></span><br>
	      		<span class="subTitle">회원님이 남겨주신 후기는 다른분들에게 큰 도움이 됩니다.</span><hr>
	      			<p class ="rating"><b>만족도</b></p>
	       		<select id="satisfy" name="satisfy" background-color="red">	       		
					<option value="1">1</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5</option>
				</select><hr>
				
					<p class ="rating"><b >청결도</b></p>
	       		<select id="cleanness" name="cleanness">	       		
					<option value="1">1</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5</option>
				</select><hr>
				
					<p class ="rating"><b>의사소통</b></p>
	       		<select id="rComm" name="rComm">	       		
					<option value="1">1</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5</option>
				</select><hr>
				
					<p class ="rating"><b>위치성</b></p>
	       		<select id="rLocation" name="rLocation">	       		
					<option value="1">1</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5</option>
				</select><hr>
				
					<p class ="rating" style="margin-bottom: 10px;"><b>정확성</b></p>
	       		<select id="accuracy" name="accuracy">	       		
					<option value="1">1</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5</option>
				</select>
				<br><hr>
				<p class="rating"><b>후기 내용</b></p><br>
				
				<textarea class="form-control"  rows="10" id="rContent" name="rContent"></textarea><br>
				<label className="input-file-button" for="input-file" >사진 업로드(최대 3장까지만 가능합니다)</label><br>
				
				
				
				 <input type="file" name="uploadFile" id="uploadFile" multiple="true">			 
				 <br> 			
				</form>
				 
				 
        <div id="preview"></div>
	      </div>
	      <div class="modal-footer">
	        <button type="submit" class="btn btn-dark" id="reviewSubmit">제출</button>
	        <button type="submit" class="btn btn-dark" id="reviewUpSub">수정</button>
	      </div>
	    </div>
	  </div>
	</div>
		
	<!-- 강의 신청 -->
	<div id="s_new_slider" class="carousel slide carousel-multi-item" data-ride="carousel" data-interval="false">
	
	<div>
	<div class='ocSubTitle2' id='teacherTitle'>강의 신청하기</div>
	<div class="memCounter">
		<form class="memCounterFrm">
			<fieldset>
		        <input type="button" value="-" class="decrease">
		        <input type="text" size="1" id="maxMember" value="1">
		        <input type="button" value="+" class="increase">
	   	 	</fieldset>
		</form>
	</div>
	<!-- 이동버튼 -->
	<div class="paginate_btn">
	<a href="#s_new_slider" class="paginate left" data-slide="prev" >
       <i></i>
       <i></i>
     </a>
	<!-- 카운터 부분 -->
	<div class="counter"></div>
     <a href="#s_new_slider" class="paginate right" data-slide="next">
       <i></i>
       <i></i>
    </a>
    </div>
    </div>
	<!--Slides-->
	<div class="carousel-inner classScheduleList" role="listbox">
	
	
	</div>
	
	<!-- Slider Controls -->
	<div class="carousel-indicators">
	   <li data-target="#s_new_slider" data-slide-to="0" class="active"></li>
       <li data-target="#s_new_slider" data-slide-to="1"></li>
	</div>

	<div align=center>
		<button type='button' class='allScheduleModalBtn' data-toggle="modal" onclick="" data-target="#allSchedule">일정 전체보기</button>
	</div>

	</div>
	
	<div class='hrMargin'><hr></div>

</div>


<!-- 강의 문의하기 버튼  --> 
<div class='detailViewQuestContainer'>
	<div class='dText1'>지금 보고계신 강의에</div>
	<div class='dText2'>궁굼한 점이</div>
	<div class='dText3'>있나요?</div>
	<div class='dText4' onclick='dqModalShow()'>네</div>
</div>
<!-- 강의 문의하기 버튼  --> 
<div class='detailViewClassContainer'>
	<div class='dText5'>지금 바로</div>
	<div class='dText6'>강의를</div>
	<div class='dText7'>신청하세요!</div>
	<div class='dText8' onclick='dqGO()'>GO</div>
</div>

<!-- 강의 문의하기 Modal -->
<div class='dqModal'>
	<div class='dqMain'>수업에 대해 궁굼한 점을 입력하세요</div>
	<input id='dqTitle' placeholder="제목"><br>
	<textarea id='dqContent'>문의 내용</textarea><br>
	<div class='dqBtns'>
	<input type='button' class='dqBtn' onclick='dqSubmit()' value='완료'> 
	<input type='button' class='dqBtn' onclick='dqCan()' value='취소'> 
	</div>
</div>
	
<div id='footer'></div>	
<script>
// 문의하기 버튼
$('.dqModal').hide();
function dqModalShow(){
	if(login == null){
		alert('문의사항은 로그인이 필요한 서비스 입니다');
	}
	else{
		$('.dqModal').show();
	    $('body').css("background-color","rgba(0, 0, 0, 0.7)");
	    $('.detailViewQuestContainer').css("opacity","0.1");
	    $('.detailViewClassContainer').css("opacity","0.1");
	    $('.onedayClassImageBoxA').css("opacity","0.1");
	    $('.onedayClassImageBoxB').css("opacity","0.1");
	    $('.onedayClassImageBoxC').css("opacity","0.1");
	    $('#map').css("opacity","0.1");
	}
};

function dqCan(){
	$('.dqModal').hide();
    $('body').css("background-color","rgba(0, 0, 0, 0)");
    $('.detailViewQuestContainer').css("opacity","");
    $('.detailViewClassContainer').css("opacity","");
    $('.onedayClassImageBoxA').css("opacity","");
    $('.onedayClassImageBoxB').css("opacity","");
    $('.onedayClassImageBoxC').css("opacity","");
    $('#map').css("opacity","");
}

function dqSubmit(){
	if($("#dqTitle").val()==""){
		alert('제목을 입력하세요');
		$("#dqTitle").focus();	
	}
	else if($("#dqContent").val()==""){
		alert('내용을 입력하세요');
		$("#dqContent").focus();	
	}
	else{
		$.ajax({
		      url:"http://localhost:3000/writeNotisBbs", 
		      type:'post',
		      data:{memNum:json.memNum, nTitle:$("#dqTitle").val(), nContent:$("#dqContent").val()},
		      success:function( result ){
		    	  if(result)
		    		alert("문의 완료! 답변은 메일로 받을 수 있습니다.");
		    	 	$("#dqTitle").val("");
		    	 	$("#dqContent").val("문의 내용");
		    		$('.dqModal').hide();
		    	    $('body').css("background-color","rgba(0, 0, 0, 0)");
		    	    $('.detailViewQuestContainer').css("opacity","");
		    	    $('.detailViewClassContainer').css("opacity","");
		    	    $('.onedayClassImageBoxA').css("opacity","");
		    	    $('.onedayClassImageBoxB').css("opacity","");
		    	    $('.onedayClassImageBoxC').css("opacity","");
		    	    $('#map').css("opacity","");
		      },
		      error:function(){
		 		alert('writeNotisBbs ajax Error');
	    	 	$("#dqTitle").val("");
	    	 	$("#dqContent").val("");
	    		$('.dqModal').hide();
	    	    $('body').css("background-color","rgba(0, 0, 0, 0)");
	    	    $('.detailViewQuestContainer').css("opacity","");
	    	    $('.detailViewClassContainer').css("opacity","");
	    	    $('.onedayClassImageBoxA').css("opacity","");
	    	    $('.onedayClassImageBoxB').css("opacity","");
	    	    $('.onedayClassImageBoxC').css("opacity","");
	    	    $('#map').css("opacity","");
		      }
		});
	}
}
// 우측 강의신청 버튼
function dqGO(){
	$("#allSchedule").modal();
}
</script>

<!-- 신청 결제 모달 -->
<div class="modal fade" style="z-index: 2000" id="requestModal" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content _requestPage">
            
        </div>
    </div>
</div>

<!-- 일정 전체보기 Modal -->
<!--allSchedule Modal -->
<div class="modal fade allScheduleModal" id="allSchedule" tabindex="-1" aria-labelledby="allScheduleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content" style="width: 700px"> 
      <div class="modal-header">
        <h5 class="modal-title" id="allScheduleModalLabel" style="text-align: center;">일정 전체보기</h5>
        <button type="button" class="close" onclick="allScheduleHide()" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body oneClsSche">
      	<div style="margin-left: 100px;">
		 <font style="float: left;">Date: <input type="text" id="datepicker"></font>
		<form  class="scMemCounterFrm" style="padding-left: 20px; float: left;">
			<fieldset>
		        <input type="button" value="-" class="scDecrease" />
		        <input type="text" size="1" id="scMaxMember" value="1" />
		        <input type="button" value="+" class="scIncrease" />
	   	 	</fieldset>
		</form>
		<button type='button' class='ccSelectBtn' classtitle="" style="width: 15%">신청</button>
		</div>
      	 <hr>
      	 <div class="allScheduleList">
      	 	
      	 </div>
      </div>
    </div>
  </div>
</div>


<!-- 금액이 모자를 경우 충전하는 것으로 이동할지 여부를 묻는 모달 -->
<div id="addChargeMoal" style="z-index: 2001" class="modal fade">
	<div class="modal-dialog modal-confirm">
		<div class="modal-content">
			<div class="modal-header flex-column">
				<div class="addChargelogo">
					<h2 class="addChargelogoAclap" onclick="ACLAP();return false;">ACLAP</h2>
					<h2 class="addChargelogoAclap" onclick="ACLAP();return false;">ACLAP</h2>
				</div>					
				<h4 class="modal-title w-100">금액이 모잘라요...충전을 하시겠습니까?</h4>	
			</div>
			<div class="modal-footer justify-content-center">
				<button type="button" class="btn btn-secondary" id="addChargeYES">YES</button>
				<button type="button" class="btn btn-danger" id="addChargeNO" data-dismiss="modal">NO</button>
			</div>
		</div>
	</div>
</div>

<script>
$("#naviBar").load("../navibar.html");
$("#footer").load("../footer.html");

let memPoint = "";
let includMem = "";	// 해당 수업에 이미 참여중인지 유무

$(document).ready(function(){
	let login = sessionStorage.getItem("login");
	let json = JSON.parse(login); // String -> json
	
	if(login != null){
		getMemDto(json.memNum);
	}
	$.ajax({
	      url:"http://localhost:3000/classDtail", 
	      type:'post',
	      data:{classNum:seq},
	      success:function( dto ){
	    	  	// 1. 제목 부분
	    	  	// 스몰로고 
	    	  	if(dto.primaryCategory == '외국어'){
					$("#pCategory").attr("class", "fas fa-language");
					$("#pCategory").html("&nbsp;외국어");
				}else if(dto.primaryCategory == '크리에이티브'){
					$("#pCategory").attr("class", "fas fa-palette");
					$("#pCategory").html("&nbsp;크리에이티브");
				}else if(dto.primaryCategory == '요리'){
					$("#pCategory").attr("class", "fas fa-utensils");
					$("#pCategory").html("&nbsp;요리");
				}else if(dto.primaryCategory == '프로그래밍'){
					$("#pCategory").attr("class", "fas fa-code");
					$("#pCategory").html("&nbsp;프로그래밍");
				}else if(dto.primaryCategory == '스포츠레저'){
					$("#pCategory").attr("class", "fas fa-dumbbell");
					$("#pCategory").html("&nbsp;스포츠/레저");
				}
	    	  	
	    	  	$(".onedayClassTitle").text(dto.title);
	//			$("#starGrade").html(dto.avgPoint + "<span id='starGradeCount' style='font-weight: 300;'>(10)</span>");
	    	  	$("#DetailLocation").text((dto.location).replace("#", " "));
	    	  	
	    	  	// 2. 이미지 부분
	    	  	if(dto.layerSelect=='A'){
	    	  		$(".onedayClassImageBoxA").show();
	    	  		$(".onedayClassImageBoxB").hide();
	    	  		$(".onedayClassImageBoxC").hide();
	    	  		$("#_ocImgA1, #img1").attr("src", dto.image1);
	    	  		$("#_ocImgA2, #img2").attr("src", dto.image2);
	    	  		$("#_ocImgA3, #img3").attr("src", dto.image3);
	    	  		$("#_ocImgA4, #img4").attr("src", dto.image4);
	    	  		$("#_ocImgA5, #img5").attr("src", dto.image5);
	    	  	//	$("#img1").attr("src", dto.image1);
	    	  	}else if(dto.layerSelect=='B'){
	    	  		$(".onedayClassImageBoxB").show();
	    	  		$(".onedayClassImageBoxA").hide();
	    	  		$(".onedayClassImageBoxC").hide();
	    	  		$("#_ocImgB1, #img1").attr("src", dto.image1);
	    	  		$("#_ocImgB2, #img2").attr("src", dto.image2);
	    	  		$("#_ocImgB3, #img3").attr("src", dto.image3);
	    	  		$("#_ocImgB4, #img4").attr("src", dto.image4);
	    	  		$("#_ocImgB5, #img5").attr("src", dto.image5);
	    	  	}else if(dto.layerSelect=='C'){
	    	  		$(".onedayClassImageBoxC").show();
	    	  		$(".onedayClassImageBoxA").hide();
	    	  		$(".onedayClassImageBoxB").hide();
	    	  		$("#_ocImgC1, #img1").attr("src", dto.image1);
	    	  		$("#_ocImgC2, #img2").attr("src", dto.image2);
	    	  		$("#_ocImgC3, #img3").attr("src", dto.image3);
	    	  		$("#_ocImgC4, #img4").attr("src", dto.image4);
	    	  		$("#_ocImgC5, #img5").attr("src", dto.image5);
	    	  	}
	    	  	
	    	  	// 3. ~~님이 개설한 클래스
	    	  	$("#nickNameTit").text(dto.instructor + " 님이 개설한 클래스");
	    	  	
	    	  	$("#classTime").text(dto.duration + "분");
	    	  	$("#classMaxNum").text(dto.limitNum + "명");
	    	  	$("#classSupplie").text(dto.preparation);
	    	  	
	    	  	$(".classInfo").html(dto.information);
	    	    
	    	  	// 4. 프로그램 설명
	    	  	$("#program").html(dto.content);
	    	  	
	    	  	// 5. YouTube
	    	  	if(dto.youtubeLink == null || dto.youtubeLink == "" || dto.youtubeLink == '0'){
	    	  		$("#youTubeLine").hide();
	    	  		$("#youTubeTitle").hide();
	    	  		$("#youtubeLink").hide();
	    	  	}else{
		    	  	let youtubeLink = dto.youtubeLink;
		    	  	let nYoutubeLink = youtubeLink.replace("watch?v=", "embed/");
		    	  	$("#youtubeLink").attr("src", nYoutubeLink);
	    	  	}
	    	  	// 6. 선생님 소개
	    	  	$("#_ocTeacherImg").attr("src", dto.profilePic);
	    	  	$("#teacherTitle").text(dto.instructor + " 선생님 소개");
	    	  	$(".ocTeacherMail").text(dto.email);
	    	  	masterClass(dto.masterNum);
	    	  	$("#TeacherInfo").html(dto.aboutMe);
	    	  	
	    	  	// 7. 수업 장소
	    	  	$("#location").text((dto.location).replace("#", " "));
	    	  	let location = (dto.location).split('#');
	    	  	addressSearch(location[0]);
	    	  	
	    	  	// 8. 리뷰 부분
	    	  	checkMember();
	    	  	
	    	    // 9. class 일정 뿌려주는 부분---------------------------------------------------------------------
				let pDate = new Date();
				let fpDate = dateFormat(pDate);
				// alert("pDate : " + pDate.getDate());
				let startDate = new Date((dto.startDate).substring(0,10));
				let endDate = new Date((dto.endDate).substring(0,10));
				
				// startDate 와 endDate 비교
		        let s_eDate = dateDiff(startDate, endDate);
		         
				// 현재 날과 startDate 비교
				let s_pDate = dateDiff(startDate, pDate);
				// alert(s_pDate);
				$(".ccSelectBtn").attr("classtitle", dto.title);
				$(".ccSelectBtn").attr("masterNum", dto.masterNum);
				
				if(s_pDate >= 0){
					//alert("이미시작함");
					
					classSchedulList(dto.classNum, dateFormat(pDate), (dto.endDate).substring(0,10), dto.limitNum, dto.title, dto.masterNum);
					
				}else{
					//alert("아직 시작안함");
					let startDate = new Date((dto.startDate).substring(0,10));
				
					startDate.setDate(startDate.getDate() -1);
					
					startDate = dateFormat(startDate);
					classSchedulList(dto.classNum, startDate, (dto.endDate).substring(0,10), dto.limitNum, dto.title, dto.masterNum);
				}
				
				//10. 이미지 클릭시 확대 모달
				
	      },
          error:function(){
        	  alert("error");
          }
		           
	});
	// Like 유무 체크
	if(login != null){
		$.ajax({
			url:"http://localhost:3000/checkLike",  
			type:"post",
			data:{memNum:json.memNum, classNum:seq},
			success:function(result){
				if(result){
					$(".DetailLikeBtn").css("color", "red");
					$(".DetailLikeBtn").attr('check', 'yes');
				}
			},
			error:function(){
				alert("checkLike ajax error");
			}
		});
	}
	
	
	function classSchedulList(classNum, startDate, endDate, limitNum, classtitle, masterNum){
		
		$.ajax({
		      url:"http://localhost:3000/classSchedulList", 
		      type:'post',
		      data:{classNum:classNum, startDate:startDate, endDate:endDate},
		      success:function( map ){
		     		let noDateArray = new Array();
		     		let z = 0;
		     		
		     		let clist = map.clist;
		     		let noDateList = map.noDateList;
		     		
		     		for(z=0; z<noDateList.length; z++){
		     			noDateArray[z] =  (noDateList[z].rdate).substring(0,10);
		     		}
		     		
					$(".classApplicatoinBox").remove();   
					
					// 강의 신청하기 list를 append해주는 src
					let src = "<div class='carousel-item active'>"
		                  					+ "<div class='classApplication_Container'>";
		
					for(let i=1; i < clist.length+1; i++){
						let classSchedule = clist[i-1];
						let rdate = (classSchedule.rdate).substring(0,10);
						
						let sbtn = "";
						
						if(classSchedule.limitNum > 0){
	                     	sbtn += "<button type='button' class='caSelectBtn' title='' cDate='" + rdate + "' classtitle='"+ classtitle +"' masterNum='"+ masterNum +"' style='margin-top: 20px;margin-left: 50px;'>신청</button>";
	                    }else{
	                    	sbtn += "<button type='button' class='eaSelectBtn' style='margin-top: 20px;margin-left: 50px;'>마감</button>";
	                    	noDateArray[z] = rdate;
	                    	z = z+1;
	                    }
						
						src += "<div class='classApplicatoinBox'>"
						                     + "<div class='caDate'>" + rdate + "</div>"
						                     + "<div class='caTime'><i class='fas fa-clock'></i> " + classSchedule.duration + "분</div>"
						                     + "<div class='caMem'><i class='material-icons' style='font-size:19 px'>people</i> " + classSchedule.limitNum + "명</div>"
						                     + "<div class='coinNprice'>"
						                           + "<i class='fas fa-donate'></i>"
						                           + "<span class='caPrice'> " + comma(classSchedule.price) + "point</span>"
						                     + "</div>"
						                     + sbtn
						              	+ "</div>";
						// 다음 슬라이드
						if(i != 1 && i%5 == 0){
							src += "</div></div>"
									+ "<div class='carousel-item'>"
										+ "<div class='classApplication_Container'>";
						}	  
						
					}
					src += "</div></div>";
					
					pagenation(clist.length);
					
					$(".classScheduleList").append(src);
					
					$(".clsSchedule").remove();
					
					// 강의 전체보기를 append해주는 src2
					let src2 = "";
					
					for(let i=1; i < clist.length+1; i++){
						let classSchedule = clist[i-1];
						let rdate = (classSchedule.rdate).substring(0,10);
						
						let sbtn = "";
						if(classSchedule.limitNum > 0){
	                     	sbtn += "<button type='button' class='cbSelectBtn' cDate='" + rdate + "' classtitle='"+ classtitle +"' masterNum='"+ masterNum +"' style='margin-left: 360px; margin-top: 10px;'>신청</button>";
	                    }else{
	                    	sbtn += "<button type='button' class='eaSelectBtn' style='margin-left: 360px; margin-top: 10px;'>마감</button>";
	                    }
						
						src2 += "<div class='clsSchedule'>"
					      	 	+	"<div class='csDate'>"+ rdate +"</div>"
								+	"<div style='margin-top: 10px;'><div class='csTime'><i class='fas fa-clock'></i> "+ classSchedule.duration + "분</div>"
								+	"<div class='csMem'><i class='material-icons'>people</i> "+ classSchedule.limitNum +"명</div>"
								+	"<div class='csCoin'>"
						        +        "<i class='fas fa-donate'></i>"
						        +        "<span class='csPrice'> "+ comma(classSchedule.price) +"point</span>"
								+	"</div></div>"
								+	sbtn
				      	 	  + "</div>";
					}
					$(".allScheduleList").append(src2);
					
					let setStartDate = new Date(startDate);
					setStartDate.setDate(setStartDate.getDate() +1);
					setStartDate = dateFormat(setStartDate);
					
					datePicker(setStartDate, endDate, noDateArray);
					
					memberCounter(limitNum);
					
					$(".caSelectBtn").on("click", function(){
						if(login == null){
							location.href="../loginRegi/loginRegi.html"
							return;
						}
						
	                	let joinNum = $("#maxMember").val(); // 사용자가 신청한 인원
	                	let cdate = $(this).attr("cdate");	// 사용자가 신청한 날짜
	                	let classMaxNum = "";				// 그 날에 예약 가능 인원
	                	let myPoint = memPoint-(clist[0].price*joinNum)	// 신청 후 나의 잔액
	                	let rPoint = clist[0].price * joinNum; // 결제 금액
	                	let classTitle = $(this).attr("classtitle");
	                	let masterNum= $(this).attr("masterNum"); // 가입자와 class master와 같은 사람인지 판별하기 위함
	                	getIncludMember(json.memNum, seq, cdate);
	   
	                	if(masterNum==json.memNum){
	                		alert("개설자는 가입할 수 없습니다.");
	                		return;
	                	}
	                
	                	if(joinNum==0){
	                		alert("인원수를 다시한번 확인해주세요");
	                		return;
	                	}
	                	
	                	if(includMem>0 ){
	                		alert("이미 신청 한 날짜 입니다. 다시 한번 확인 부탁드립니다.");
							return;
						}
	   
	                	for(let i=1; i < clist.length+1; i++){
							let classSchedule = clist[i-1];
							let rdate = (classSchedule.rdate).substring(0,10);
							
							if(rdate==cdate){
								classMaxNum = classSchedule.limitNum;
								break;
							}
	               		}
	                	
	                	if(classMaxNum < joinNum){
	                		alert("예약 가능 인원을 초과하였습니다. 죄송합니다.");
	                		return;
	                	}
	                	
	                	$("#requestPage").remove();
	                	
	                	let src3 = "<div class='modal-body' id='requestPage'>"
									 +"<div class='text-right'> <i class='fa fa-times close' data-dismiss='modal'></i> </div>"
									 + "<div class='px-4 py-5' style='border: 1px solid #d2d2d2; margin-top:20px; border-radius:20px;'>"
									 	+ "<h3 class='text-uppercase'>ACLAP</h3>"
									 	+ "<h5 class='mt-5 theme-color mb-5'>수업에 참여해 주셔서 감사합니다.</h5>"
									 	+ "<span class='theme-color'>결제 내역</span>"
									 	+ "<div class='d-flex justify-content-between'> <span class='font-weight-bold'>보유 포인트</span> <span class='text-muted'>" + comma(memPoint) + "point</span> </div>"
									 	+ "<div class='d-flex justify-content-between'> <span class='font-weight-bold'>"+ classTitle +"</span> <span class='text-muted'>" +  comma(rPoint) + "point</span> </div>"
									 	+ "<div class='mb-3'>"
									 		+ "<hr class='new1'>"
									 	+ "</div>"
									 	+ " <div class='d-flex justify-content-between mt-3'> <span class='font-weight-bold'>결제 후 잔여 포인트</span> <span class='font-weight-bold theme-color'> " + comma(myPoint) + "point</span> </div>"
									 	+ "<div class='text-center mt-5'> <button class='btn btn-primary' classNum='" + classNum + "' memNum='" + json.memNum + "' myPoint='" + myPoint + "' rPoint='" + rPoint + "' cdate='" + cdate + "' joinNum='" +joinNum+ "' id='participate'>참여하기</button> </div>"
									 + "</div>"
								 + "</div>";
	                
	               		$("._requestPage").append(src3);
	                
	                	$("#requestModal").modal('show');
	                	
	                	participate();
	                });
	                
	               	$(".cbSelectBtn").on("click", function(){
	               		if(login == null){
							location.href="../loginRegi/loginRegi.html"
							return;
						}
	               		
	          
	               		let joinNum = $("#scMaxMember").val(); // 사용자가 신청한 인원
	                	let cdate = $(this).attr("cdate");	// 사용자가 신청한 날짜
	                	let classMaxNum = "";				// 그 날에 예약 가능 인원
	                	let myPoint = memPoint-(clist[0].price*joinNum)	// 신청 후 나의 잔액
	                	let rPoint = clist[0].price * joinNum; // 결제 금액
	                	let classTitle = $(this).attr("classtitle");
	                	let masterNum= $(this).attr("masterNum"); // 가입자와 class master와 같은 사람인지 판별하기 위함
	                	
	                	getIncludMember(json.memNum, seq, cdate);
	                	
	                	if(masterNum==json.memNum){
	                		alert("개설자는 가입할 수 없습니다.");
	                		return;
	                	}
	                	
	               		if(joinNum==0){
	                		alert("인원수를 다시한번 확인해주세요");
	                		return;
	                	}
	                	
	               		if(includMem>0 ){
	               			alert("이미 신청 한 날짜 입니다. 다시 한번 확인 부탁드립니다.");
							return;
						}
	               		
	               		for(let i=1; i < clist.length+1; i++){
							let classSchedule = clist[i-1];
							let rdate = (classSchedule.rdate).substring(0,10);
							
							if(rdate==cdate){
								classMaxNum = classSchedule.limitNum;
								break;
							}
	               		}
	                	
	                	if(classMaxNum < joinNum){
	                		alert("예약 가능 인원을 초과하였습니다. 죄송합니다.");
	                		return;
	                	}
	                	
						$("#requestPage").remove();
	                	
	                	let src3 = "<div class='modal-body' id='requestPage'>"
									 +"<div class='text-right'> <i class='fa fa-times close' data-dismiss='modal'></i> </div>"
									 + "<div class='px-4 py-5' style='border: 1px solid #d2d2d2; margin-top:20px; border-radius:20px;'>"
									 	+ "<h3 class='text-uppercase'>ACLAP</h3>"
									 	+ "<h5 class='mt-5 theme-color mb-5'>수업에 참여해 주셔서 감사합니다.</h5>"
									 	+ "<span class='theme-color'>결제 내역</span>"
									 	+ "<div class='d-flex justify-content-between'> <span class='font-weight-bold'>보유 포인트</span> <span class='text-muted'>" + comma(memPoint) + "point</span> </div>"
									 	+ "<div class='d-flex justify-content-between'> <span class='font-weight-bold'>"+classTitle+"</span> <span class='text-muted'>" + comma(rPoint) + "point</span> </div>"
									 	+ "<div class='mb-3'>"
									 		+ "<hr class='new1'>"
									 	+ "</div>"
									 	+ " <div class='d-flex justify-content-between mt-3'> <span class='font-weight-bold'>결제 후 잔여 포인트</span> <span class='font-weight-bold theme-color'> " + comma(myPoint) + "point</span> </div>"
									 	+ "<div class='text-center mt-5'> <button class='btn btn-primary' classNum='" + classNum + "' memNum='" + json.memNum + "' myPoint='" + myPoint + "' rPoint='" + rPoint + "' cdate='" + cdate + "' joinNum='" +joinNum+ "' id='participate'>참여하기</button> </div>"
									 + "</div>"
							 	+ "</div>";
	                
	               		$("._requestPage").append(src3);
	           
	               		$("#requestModal").modal('show');
	               		
	               		participate();
	                });
	                
	                $(".ccSelectBtn").on("click", function(){
	                	if(login == null){
							location.href="../loginRegi/loginRegi.html"
							return;
						}
	                	
	                	let joinNum = $("#scMaxMember").val();	// 사용자가 신청한 인원
	                	let cdate = $("#datepicker").val();	// 사용자가 신청한 날짜
	                	let classMaxNum = "";				// 그 날에 예약 가능 인원
	                	let myPoint = memPoint-(clist[0].price*joinNum);	// 신청 후 나의 잔액
	                	let rPoint = clist[0].price * joinNum; // 결제 금액
	                	let classTitle = $(this).attr("classtitle");
	                	let masterNum= $(this).attr("masterNum"); // 가입자와 class master와 같은 사람인지 판별하기 위함
	                
	                	getIncludMember(json.memNum, seq, cdate);
	                	
	                	if(masterNum==json.memNum){
	                		alert("개설자는 가입할 수 없습니다.");
	                		return;
	                	}
	                	
	                	if(joinNum==0){
	                		alert("인원수를 다시한번 확인해주세요");
	                		return;
	                	}
	   					else if(cdate == ""){
	                		alert("날짜를 선택하여 주세요");
	                		return;
	                	}
	                	
	                	if(includMem>0 ){
							alert("이미 신청 한 날짜 입니다. 다시 한번 확인 부탁드립니다.");
							return;
						}
	               		
	                	
	                	for(let i=1; i < clist.length+1; i++){
							let classSchedule = clist[i-1];
							let rdate = (classSchedule.rdate).substring(0,10);
							
							if(rdate==cdate){
								classMaxNum = classSchedule.limitNum;
								break;
							}
	               		}
	                	
	                	if(classMaxNum < joinNum){
	                		alert("예약 가능 인원을 초과하였습니다. 죄송합니다.");
	                		return;
	                	}
	                	
						$("#requestPage").remove();
	                	
	                	let src3 = "<div class='modal-body' id='requestPage'>"
									 +"<div class='text-right'> <i class='fa fa-times close' data-dismiss='modal'></i> </div>"
									 + "<div class='px-4 py-5' style='border: 1px solid #d2d2d2; margin-top:20px; border-radius:20px;'>"
									 	+ "<h3 class='text-uppercase'>ACLAP</h3>"
									 	+ "<h5 class='mt-5 theme-color mb-5'>수업에 참여해 주셔서 감사합니다.</h5>"
									 	+ "<span class='theme-color'>결제 내역</span>"
									 	+ "<div class='d-flex justify-content-between'> <span class='font-weight-bold'>보유 포인트</span> <span class='text-muted'>" + comma(memPoint) + "point</span> </div>"
									 	+ "<div class='d-flex justify-content-between'> <span class='font-weight-bold'>"+classTitle+"</span> <span class='text-muted'>" + comma(rPoint) + "point</span> </div>"
									 	+ "<div class='mb-3'>"
									 		+ "<hr class='new1'>"
									 	+ "</div>"
									 	+ " <div class='d-flex justify-content-between mt-3'> <span class='font-weight-bold'>결제 후 잔여 포인트</span> <span class='font-weight-bold theme-color'> " + comma(myPoint) + "point</span> </div>"
									 	+ "<div class='text-center mt-5'> <button class='btn btn-primary' classNum='" + classNum + "' memNum='" + json.memNum + "' myPoint='" + myPoint + "' rPoint='" + rPoint + "' cdate='" + cdate + "' joinNum='" +joinNum+ "' id='participate'>참여하기</button> </div>"
									 + "</div>"
								 + "</div>";
	                
	               		$("._requestPage").append(src3);
	                	
	                	$("#requestModal").modal('show');
	                	
	                	participate();
	                });
	                
	                function participate(){
		                $("#participate").on("click", function(){
		                	let classNum = $(this).attr("classNum"); // 클릭한 classNum
							let memNum = $(this).attr("memNum"); 	
		                	let cdate = $(this).attr("cdate");
							let myPoint = Number($(this).attr("myPoint")); // 결제 후 금액
							let rPoint = Number($(this).attr("rPoint"));	// 결제 한 금액
							let participants = $(this).attr("joinNum"); // 사용자가 신청한 사람 수

							// 자신이 가진 금액이 더 적을 경우
							if(myPoint < 0){
								$("#addChargeMoal").modal('show');
								return;
							}
							
							$.ajax({
								url:"http://localhost:3000/participate", 
							    type:'post',
							    data:{classNum:classNum, memNum:json.memNum, classDate:cdate, name:json.nickName, rPoint:rPoint, participants:participants},
							    success: function(mag){
							    	//alert(mag);json.myPoint
							    	$("#requestModal").modal('hide');
								    $("#allSchedule").modal('hide');
								    location.reload(true);
							    },
							    error: function(){
							    	alert('error');
							    }
							});
							
		                });
	                }
		      },
	        error:function(){
	      	  alert("error");
	        }         
		});
	}
	// 강의신청 Pagenation
	// pagination
	function pagenation(len){
		let pr = document.querySelector( '.paginate.left' );
		let pl = document.querySelector( '.paginate.right' );
	
		pr.onclick = slide.bind( this, -1 );
		pl.onclick = slide.bind( this, 1 );
		
		let page = Math.floor(len/5); // 소수점 버림
		// alert(page);

		if(page==0){
			$(".left").hide();
			$(".right").hide();
		}
		if(len%5 != 0){
			page = page + 1;
		}
		if(page>6){
			page = 6;
		}
		let index = 0, total = page;
	
		function slide(offset) {
			index = Math.min( Math.max( index + offset, 0 ), total - 1 );
			if(index == 0 && page != 2){
				$(".left").hide();
			}else if(index == page-1 && page != 2){
				$(".right").hide();
			}else{
				$(".left").show();
				$(".right").show();
			}
			
			document.querySelector( '.counter' ).innerHTML = ( index + 1 ) + ' / ' + total;
			
			pr.setAttribute( 'data-state', index === 0 ? 'disabled' : '' );
			pl.setAttribute( 'data-state', index === total - 1 ? 'disabled' : '' );
		} 
	
		slide(0);
	}
	
	// 두개의 날짜를 비교하여 차이를 알려준다.
	function dateDiff(_date1, _date2) {
	    let diffDate_1 = _date1 instanceof Date ? _date1 :new Date(_date1);
	    let diffDate_2 = _date2 instanceof Date ? _date2 :new Date(_date2);
	 
	    diffDate_1 =new Date(diffDate_1.getFullYear(), diffDate_1.getMonth()+1, diffDate_1.getDate());
	    diffDate_2 =new Date(diffDate_2.getFullYear(), diffDate_2.getMonth()+1, diffDate_2.getDate());
	 
	    let diff = diffDate_2.getTime() - diffDate_1.getTime();
	    diff = Math.ceil(diff / (1000 * 3600 * 24));
	 
	    return diff;
	}
	
	function dateFormat(date){
	      // alert(date);
	      let year = date.getFullYear();
	      let month = date.getMonth()+1;
	      let day = date.getDate();
	      
	      let sDate = year + "-" + two(month + "") + "-" + two(day + "");
	      return sDate;
	}
	   
   function two(msg){
      return msg.length<2?"0"+msg:msg; // 글자수가 2보다 작을때 0을 붙여서 반환한다.
   };
	
	function datePicker(startDate, endDate, noDateList){
		// let noDateArray = ["2021-05-14","2021-05-15","2021-05-16"]
		// alert(startDate + "," + endDate + "," + noDateArray);
		
		$.datepicker.setDefaults({
	        dateFormat: 'yy-mm-dd',
	        prevText: '이전 달',
	        nextText: '다음 달',
	        monthNames: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
	        monthNamesShort: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
	        dayNames: ['일', '월', '화', '수', '목', '금', '토'],
	        dayNamesShort: ['일', '월', '화', '수', '목', '금', '토'],
	        dayNamesMin: ['일', '월', '화', '수', '목', '금', '토'],
	        showMonthAfterYear: true,
	        yearSuffix: '년',
	        monthRange:"06:07",
	        minDate: new Date(startDate),
	        maxDate: new Date(endDate),
	       	beforeShowDay: function(date){
		        let string = jQuery.datepicker.formatDate('yy-mm-dd', date);
		        return [ noDateList.indexOf(string) == -1 ]
	        }
	    });
		
		$( function() {
			$( "#datepicker" ).datepicker();
		});
	}
	
	function comma(num){
	    let len, point, str; 
	       
	    num = num + ""; 
	    point = num.length % 3 ;
	    len = num.length; 
	   
	    str = num.substring(0, point); 
	    while (point < len) { 
	        if (str != "") str += ","; 
	        str += num.substring(point, point + 3); 
	        point += 3; 
	    } 
	     
	    return str;
	}
	
	// 강의 신청 인원수 받기
	function memberCounter(maxMember){
		
		$(function () {
		    set_($('#maxMember'), maxMember);  
		    set_($('#scMaxMember'), maxMember);  
		    
		    function set_(_this, max) {
		        let block = _this.parent();
		        
		        block.find(".increase").click(function () {
		            let currentVal = parseInt(_this.val());
		            if (currentVal != NaN && (currentVal + 1) <= max) {
		                _this.val(currentVal + 1);
		            }
		        });
	
		        block.find(".decrease").click(function () {
		            let currentVal = parseInt(_this.val());
		            if (currentVal != NaN && currentVal != 0) {
		                _this.val(currentVal - 1);
		            }
		        });
		        
		        block.find(".scIncrease").click(function () {
		            let currentVal = parseInt(_this.val());
		            if (currentVal != NaN && (currentVal + 1) <= max) {
		                _this.val(currentVal + 1);
		            }
		        });
	
		        block.find(".scDecrease").click(function () {
		            let currentVal = parseInt(_this.val());
		            if (currentVal != NaN && currentVal != 0) {
		                _this.val(currentVal - 1);
		            }
		        });
		        
		    }
		});
	}
	
	$("#addChargeYES").on("click", function(){
		$("#requestModal").modal('hide');
	    $("#allSchedule").modal('hide');
	    $("#addChargeMoal").modal('hide');
	    $("#staticBackdrop").modal('show');
	});
	

});

function getMemDto(memNum){
	$.ajax({
		url:"http://localhost:3000/getMemberDto", 			
		type:"post",
		data:{memNum:memNum},
	 	success:function( memDto ){
	 		memPoint = memDto.myPoint;
		},
		error:function(){
			alert('error');
		}
	});
}

function getIncludMember(memNum, classNum, classDate){
	$.ajax({
		url:"http://localhost:3000/getIncludMember", 			
		type:"post",
		data:{memNum:memNum, classNum:classNum, rdate:classDate},
		async:false,
	 	success:function( count ){
	 		includMem = count;
		},
		error:function(){
			alert('error');
		}
	});
}

function allScheduleHide(){
	$("#allSchedule").modal('hide');
}
</script>


<script>

// 이미지 프레임 선택 버튼
$(document).ready(function(){
	$(".onedayClassImageBoxB").hide();
	$(".onedayClassImageBoxC").hide();
});
let chech2 = false;
let chech3 = false;
function showLayer1(){
	$(".onedayClassImageBoxA").show();
	$(".onedayClassImageBoxB").hide();
	$(".onedayClassImageBoxC").hide();
		
	$("#layer1").removeClass('layerBtnNonChoice');
	$("#layer2").removeClass('layerBtnChoice');
	$("#layer3").removeClass('layerBtnChoice');
	$("#layer1").addClass('layerBtnChoice');				
	$("#layer2").addClass('layerBtnNonChoice');				
	$("#layer3").addClass('layerBtnNonChoice');				
}
function showLayer2(){
	$(".onedayClassImageBoxB").show();
	$(".onedayClassImageBoxA").hide();
	$(".onedayClassImageBoxC").hide();
	if(chech2 == false){
		$("#layer2").removeClass('layerBtnNonChoice');
		$("#layer1").removeClass('layerBtnChoice');
		$("#layer3").removeClass('layerBtnChoice');
		$("#layer2").addClass('layerBtnChoice');				
		$("#layer1").addClass('layerBtnNonChoice');				
		$("#layer3").addClass('layerBtnNonChoice');					
		check2 = true;
	}
}
function showLayer3(){
	$(".onedayClassImageBoxC").show();
	$(".onedayClassImageBoxA").hide();
	$(".onedayClassImageBoxB").hide();
	if(chech3 == false){
		$("#layer3").removeClass('layerBtnNonChoice');
		$("#layer1").removeClass('layerBtnChoice');		
		$("#layer2").removeClass('layerBtnChoice');
		$("#layer3").addClass('layerBtnChoice');				
		$("#layer1").addClass('layerBtnNonChoice');				
		$("#layer2").addClass('layerBtnNonChoice');					
		check3 = true;
	}
}

// 개설클래스 append해주는 부분
function masterClass(masterNum){
	$.ajax({
		url:"http://localhost:3000/masterClassCounter", 			
		type:"post",
		data:{masterNum:masterNum},
	 	success:function( map ){
	 		$("#masterClass").text("진행 클래스 " + map.allClass + "개");	
	 		$("#masterLikes").text(map.allLikes);	
	 	},
	 	error:function(){
	 		alert('error');
	 	}
		
	});
}
// 카카오맵 출력용 버젼
var mapContainer = document.getElementById('map'), 
    mapOption = {center: new kakao.maps.LatLng(33.450701, 126.570667), level: 1};  
var map = new kakao.maps.Map(mapContainer, mapOption); 
var geocoder = new kakao.maps.services.Geocoder();

function addressSearch(location){
	geocoder.addressSearch(location, function(result, status) {
	
	     if (status === kakao.maps.services.Status.OK) {
	        var coords = new kakao.maps.LatLng(result[0].y, result[0].x);
	        var marker = new kakao.maps.Marker({map: map, position: coords});
	
	        var infowindow = new kakao.maps.InfoWindow({
	            content: '<div style="width:150px;text-align:center;padding:6px 0;">수업 장소</div>'
	        });
	        infowindow.open(map, marker);
	        map.setCenter(coords);
	    } 
	});    
}


// 리뷰 모달 창 컨트롤
$(".reviewModalBtn").click(function(){
	$(".review_hide_modal").toggleClass("review_show_modal");	
	 $('body').css("background-color","rgba(0, 0, 0, 0.5)");
	 $('.classApplicatoinBox').css({"background-color":"rgba(0, 0, 0, 0.02)", "border":"none"});
	 $('.allScheduleModalBtn').css("background-color","rgba(0, 0, 0, 0.02)");
	 $('.caSelectBtn').css("background-color","rgba(0, 0, 0, 0.02)");
	 $('.decrease').css("background-color","rgba(0, 0, 0, 0.02)");
	 $('#maxMember').css("background-color","rgba(0, 0, 0, 0.02)");
	 $('.increase').css("background-color","rgba(0, 0, 0, 0.02)");
	 $('#map').css("opacity","0.2");
	 $('#br-widget').css("background-color","rgba(0, 0, 0, 0.02)");
	 $('.reviewModalBtn').css("background-color","rgba(0, 0, 0, 0.02)");
	 $('.detailViewClassContainer').css("opacity","0.2");
	 $('.detailViewQuestContainer').css("opacity","0.2");
	 $('.ratingAvg').css("background-color","rgba(0, 0, 0, 0.02)");
	 $('.carousel-item active').css("background-color","rgba(0, 0, 0, 0.02)");
	 $('.reviewBtn').css("background-color","rgba(0, 0, 0, 0.02)");
	 $('.fa-star').css("color","gray"); // 별 빨강색 -> 회색으로 
//	 $('.br-readonly ').css("color","#d2d2d2"); // 리뷰 별점 회색으로
	 
	
});
$(".review_modal_close").click(function(){
	$(".review_hide_modal").toggleClass("review_show_modal");	
	 $('body').css("background-color","rgba(0, 0, 0, 0)");
	 $('.classApplicatoinBox').css({"background-color":"", "border":""});
	 $('.allScheduleModalBtn').css("background-color","");
	 $('.caSelectBtn').css("background-color","");
	 $('.decrease').css("background-color","");
	 $('#maxMember').css("background-color","");
	 $('.increase').css("background-color","");
	 $('#map').css("opacity","1");
	 $('#br-widget').css("background-color","");
	 $('.reviewModalBtn').css("background-color","");
	 $('.detailViewClassContainer').css("opacity","1");
	 $('.detailViewQuestContainer').css("opacity","1");
	 $('.ratingAvg').css("background-color",")");
	 $('.carousel-item active').css("background-color","");
	 $('.reviewBtn').css("background-color","");
	 $('.fa-star').css("color","red"); // 별 빨강색 -> 회색으로 
});


//~~~~~~~~~~~~~이미지 확대 모달창

$(".image_hide_modal").hide();

let modalCheck = true;
$(".onedayClassImageBoxA").click(function(){
      if(modalCheck){
         $(".image_hide_modal").toggleClass("image_show_modal");   
         $(".image_hide_modal").show();
   	    $('body').css("background-color","rgba(0, 0, 0, 0.7)");
 	 	 $('.detailViewQuestContainer').css("opacity","0.1");
	     $('.detailViewClassContainer').css("opacity","0.1");
	     $('.onedayClassImageBoxA').css("opacity","0.1");
	     $('.onedayClassImageBoxB').css("opacity","0.1");
	     $('.onedayClassImageBoxC').css("opacity","0.1");
	     $('.DetailShareBtn').css("background-color","rgba(0, 0, 0, 0.02)");	// 공유하기
	     $('.DetailLikeBtn').css("background-color","rgba(0, 0, 0, 0.02)");		// 좋아요
	     $('.fa-star').css("color","#848484");									//별점
	     $('#map').css("opacity","0.1");
	     $('#map').css("opacity","0.1");
           
         modalCheck=false;
      };
});
$(".onedayClassImageBoxB").click(function(){
	 if(modalCheck){
         $(".image_hide_modal").toggleClass("image_show_modal");   
         $(".image_hide_modal").show();
 	    $('body').css("background-color","rgba(0, 0, 0, 0.7)");
 	 	 $('.detailViewQuestContainer').css("opacity","0.1");
	     $('.detailViewClassContainer').css("opacity","0.1");
	     $('.onedayClassImageBoxA').css("opacity","0.1");
	     $('.onedayClassImageBoxB').css("opacity","0.1");
	     $('.onedayClassImageBoxC').css("opacity","0.1");
	     $('.DetailShareBtn').css("background-color","rgba(0, 0, 0, 0.02)");	// 공유하기
	     $('.DetailLikeBtn').css("background-color","rgba(0, 0, 0, 0.02)");		// 좋아요
	     $('.fa-star').css("color","#848484");									//별점
	     $('#map').css("opacity","0.1");
	     $('#map').css("opacity","0.1");
           
         modalCheck=false;
      };
	
});
$(".onedayClassImageBoxC").click(function(){
	 if(modalCheck){
        $(".image_hide_modal").toggleClass("image_show_modal");   
        $(".image_hide_modal").show();
	    $('body').css("background-color","rgba(0, 0, 0, 0.7)");
	 	 $('.detailViewQuestContainer').css("opacity","0.1");
	     $('.detailViewClassContainer').css("opacity","0.1");
	     $('.onedayClassImageBoxA').css("opacity","0.1");
	     $('.onedayClassImageBoxB').css("opacity","0.1");
	     $('.onedayClassImageBoxC').css("opacity","0.1");
	     $('.DetailShareBtn').css("background-color","rgba(0, 0, 0, 0.02)");	// 공유하기
	     $('.DetailLikeBtn').css("background-color","rgba(0, 0, 0, 0.02)");		// 좋아요
	     $('.fa-star').css("color","#848484");									//별점
	     $('#map').css("opacity","0.1");
	     $('#map').css("opacity","0.1");
          
        modalCheck=false;
     };
	
});
   
$(".fa-times").click(function(){
   $(".image_hide_modal").toggleClass("image_show_modal");   
    $('body').css("background-color","rgba(0, 0, 0, 0)");
    $('.detailViewQuestContainer').css("background-color","");
  	$('.detailViewQuestContainer').css("opacity","");
	$('.detailViewClassContainer').css("opacity","");
   	$('.onedayClassImageBoxA').css("opacity","");
   	$('.onedayClassImageBoxB').css("opacity","");
   	$('.onedayClassImageBoxC').css("opacity","");
   	$('#map').css("opacity","");
    $('.DetailShareBtn').css("background-color","");	// 공유하기
    $('.DetailLikeBtn').css("background-color","");		// 좋아요
    $('.fa-star').css("color","red");								
    $(".image_hide_modal").hide();
    modalCheck = true;
});


//------별점---------------------------

var satisfy=cleanness=rComm=rLocation=accuracy=5;

   $(function() {
      $('#satisfy').barrating({
        theme: 'fontawesome-stars',
        initialRating : 1
        	, onSelect: function(value, text, event){
        		// 별점 클릭 후 처리는 여기서 코드
        		// 선택한 별점 값을 value로 받음        	
        		satisfy = parseInt(value);
        	//	alert("satisfy: " + typeof satisfy);
        	}
      });
      $('#cleanness').barrating({
          theme: 'fontawesome-stars',
          initialRating : 1
          	, onSelect: function(value, text, event){
          		cleanness = parseInt(value);
          	//	alert("cleanness: " + cleanness);
          	}
        });      

      $('#rComm').barrating({
          theme: 'fontawesome-stars',
          initialRating : 1
          	, onSelect: function(value, text, event){
          		rComm = parseInt(value);
          	//	alert("rComm: " + rComm);
          	}
        });
      $('#rLocation').barrating({
          theme: 'fontawesome-stars',
          initialRating : 1
          	, onSelect: function(value, text, event){
          		rLocation = parseInt(value);
          	//	alert("rLocation: " + rLocation);
          	}
        });
      
      $('#accuracy').barrating({
          theme: 'fontawesome-stars',
          initialRating : 1
          	, onSelect: function(value, text, event){
          		accuracy = parseInt(value);
          	//	alert("accuracy: " + accuracy);
          	}
        });
      
   });

// ~~~~~~~~~~다중이미지 미리보기
$(document).ready(function (e){
    $("input[type='file']").change(function(e){

      //div 내용 비워주기
      $('#preview').empty();

      var files = e.target.files;
      var arr =Array.prototype.slice.call(files);
      
      //업로드 가능 파일인지 체크
      for(var i=0;i<files.length;i++){
        if(!checkExtension(files[i].name,files[i].size)){
          return false;
        }
      }
      
      preview(arr);
      
      
    });//file change
    
    function checkExtension(fileName,fileSize){

      var regex = new RegExp("(.*?)\.(exe|sh|zip|alz)$");
      var maxSize = 20971520;  //20MB
      
      if(fileSize >= maxSize){
        alert('파일 사이즈 초과');
        $("input[type='file']").val("");  //파일 초기화
        return false;
      }
      
      if(regex.test(fileName)){
        alert('업로드 불가능한 파일이 있습니다.');
        $("input[type='file']").val("");  //파일 초기화
        return false;
      }
      return true;
    }
    
    function preview(arr){
      arr.forEach(function(f){
        
        //파일명이 길면 파일명...으로 처리
        var fileName = f.name;
        if(fileName.length > 10){
          fileName = fileName.substring(0,7)+"...";
        }
        
        //div에 이미지 추가
        var str = '<div style="display: inline-flex; padding: 10px;"><li>';
        str += '<span>'+fileName+'</span><br>';
        
        //이미지 파일 미리보기
        if(f.type.match('image.*')){
          var reader = new FileReader(); //파일을 읽기 위한 FileReader객체 생성
          reader.onload = function (e) { //파일 읽어들이기를 성공했을때 호출되는 이벤트 핸들러
            //str += '<button type="button" class="delBtn" value="'+f.name+'" style="background: red">x</button><br>';
            str += '<img src="'+e.target.result+'" title="'+f.name+'" width=100 height=100 />';
            str += '</li></div>';
            $(str).appendTo('#preview');
          } 
          reader.readAsDataURL(f);
        }else{
          str += '<img src="/resources/img/fileImg.png" title="'+f.name+'" width=100 height=100 />';
          $(str).appendTo('#preview');
        }
      });//arr.forEach
    }
  });
   
//~~~~~~~~~~~~로그인 세션~~~~~~~~~~~~~~~~
let json = JSON.parse(sessionStorage.getItem("login"));
let memNum = "";
let userName = "";
if(json != null){
	memNum = json.memNum;
	userName = json.userName;
}
//alert("멤버넘" + memNum);

//~~~~~~~~~~~리뷰제출하기 버튼 클릭~~~~~~~~~~~
$("#reviewSubmit").click(function(){

	// alert(satisfy+" "+cleanness+" "+ rComm+" "+ rLocation+" "+ accuracy);
	$("#memNum").val(memNum);
	$("#name").val(userName);
	$("#classNum").val(seq);
	  
	  $.ajax({
		 url:"http://localhost:3000/writeReview", 			
		 type:"post",
		 enctype: 'multipart/form-data', 
		 data: new FormData($("#reviewImages")[0]),  // 필수 
		 processData: false, // 필수
		 contentType: false, // 필수 
		 cache: false,
		// dataType:"json",
		 success: function(msg){
			 if(msg == "uploaded"){
			 alert('후기작성 완료!');
			 location.reload();
			 }else{
				 alert("파일을 3개이하로 올려주세요");
				 location.reload();
			 }
		 },
		 error: function(){
			 alert('에러ㅠ6ㅠ');
			 location.reload();
		 }

	  });	  
});

   
//파일 첨부 
	$(function(){
		$('.upload_text').val('미리보여줄 텍스트.');
		$('.input_file').change(function(){
			var i = $(this).val();
			$('.upload_text').val(i);
		});
	});
	
	

//~~~~~~ 리뷰 별점평균 뿌리기~~~~~

$.ajax({
		url:"http://localhost:3000/getAvg", 			
		type:"get",
		data:{classNum:seq},
		success:function(map){
			if(map.sAvg == null){
				$(".reviewBox").css('height', '50px');
				$("#saAvg").append("  "+0 + " ");
				$("#clAvg").append("  "+0 + " ");
				$("#accAvg").append("  "+0 + " ");
				$("#coAvg").append("  "+0 + " ");
				$("#loAvg").append("  "+0 + " ");
				$("#reviewGrade").prepend(0 + "점");
			}
			else{
				let avg = map.avg;
				let sAvg = map.sAvg;
				let satis = sAvg.satisfy;
				let clean = sAvg.cleanness;
				let communi = sAvg.rComm;
				let loca = sAvg.rLocation;
				let acc = sAvg.accuracy;
				$("#saAvg").append("  "+satis + " ");
				$("#clAvg").append("  "+clean + " ");
				$("#accAvg").append("  "+acc + " ");
				$("#coAvg").append("  "+communi + " ");
				$("#loAvg").append("  "+loca + " ");
				$("#starGrade").html(avg);
						
//--------------------------------별점 평균---------------------------------------
			$(function(){
				$('#satisfaction').barrating({
			        theme: 'fontawesome-stars',
			        initialRating : satis,
			        readonly : true 
			        	, onSelect: function(value, text, event){
			        		// 별점 클릭 후 처리는 여기서 코드
			        		// 선택한 별점 값을 value로 받음        	
			        		clean = parseInt(value);
			        	}
			      });
				
				$('#clean').barrating({
				        theme: 'fontawesome-stars',
				        initialRating : clean,
				        readonly : true 
				        	, onSelect: function(value, text, event){
				        		// 별점 클릭 후 처리는 여기서 코드
				        		// 선택한 별점 값을 value로 받음        	
				        		clean = parseInt(value);
				        	}
				      });
				
				$('#acc').barrating({
			        theme: 'fontawesome-stars',
			        initialRating : acc,
			        readonly : true
			        	, onSelect: function(value, text, event){
			        		acc = parseInt(value);
			        	//	alert("satisfy: " + typeof satisfy);
			        	}
			      });
				
				$('#communi').barrating({
			        theme: 'fontawesome-stars',
			        initialRating : communi,
			        readonly : true
			        	, onSelect: function(value, text, event){
			        		communi = parseInt(value);
			        	//	alert("satisfy: " + typeof satisfy);
			        	}
			      });
				
				$('#loca').barrating({
			        theme: 'fontawesome-stars',
			        initialRating : loca,
			        readonly : true
			        	, onSelect: function(value, text, event){
			        		loca = parseInt(value);
			        	//	alert("satisfy: " + typeof satisfy);
			        	}
			      });
			});
						
			$("#reviewGrade").prepend(avg + "점");
		}	
	},
	error:function(){
	//	alert('별점 평균 에러ㅜㅜ');
	}
});	

getListReview()
// ~~~~~~~~~리뷰 리스트 뿌리기~~~~~
function getListReview(){
$.ajax({
		url:"http://localhost:3000/getReviewList", 			
		type:"get",
		data:{classNum:seq},
	 	success:function(list){ 	
	 		
			$("#reviewGrade").append("(리뷰" + Object.keys(list).length + "개)");
	 //		$("#starGradeCount").html("("+Object.keys(list).length+")")		// 리뷰갯수
	 //		alert( Object.keys(list).length + "개");
	 		if(Object.keys(list).length==0){
	 		//	alert("리뷰갯수없음");	 		
	 			$(".reviewModalBtn").hide();
	 			$(".reviewAppend").css("height","60px");
	 			
	 		}
			
			// 후기 전체보기
 			let str ="";
 		//	if(Object.keys(list).length < 6 && list.del == 0){	//리뷰갯수가 6개 넘으면 후기 전체보기 모달에 다 보이게함
 				
			$.each(list, function(i, val){
				
			if(val.del == 0){
					str ="<div class='reviewModalItem'></div>";
					str +="<div style='float:left'><img src="+val.profilePic+" class='reviewImg'></div>" 
					str += "<div style='float:left;'><div class='reviewId'>"+val.name+"</div>";
					str += "<div class='reviewDate'>"+val.wDate+"</div></div>";
					str += "<br><br><br>";
					str += "<div class='reviewContent'>"+val.rContent+"</div>";
		             if(val.image1 != null && val.image2 == null && val.image3==null ){
		                if(val.image1.includes('.back')){
		                	str += "<img src=" + val.image1 + " alt=" + ">";
		                }else{
		                	str += "<img class='rImg' src=" + val.image1 + " alt=" + ">";
		                }
		             }   
		             if(val.image1 != null && val.image2 != null && val.image3==null){
		                str += "<img class='rImg' src=" + val.image1 + " alt=" + ">";
		                str += "<img class='rImg' src=" + val.image2 + " alt=" + ">";
		             }
		             if(val.image1 != null && val.image2 != null && val.image3 != null){
		                str += "<img class='rImg' src=" + val.image1 + " alt=" + ">";
		                str += "<img class='rImg' src=" + val.image2 + " alt=" + ">";
		                str += "<img class='rImg' src=" + val.image3 + " alt=" + ">";
		             }
					if(val.name == userName){
						str += "<br><button type='button' class='btn btn-light btn-sm rBtn' onClick='reviewUp(" + val.reviewSeq + ")'>수정</button>"	;
						str += "<button type='button' class='btn btn-light btn-sm rBtn' id='reviewDel' onClick='reviewDel("+val.reviewSeq+")'>삭제</button>"	;
					}
				}
			$(".review_Modal_Content").append(str);
		});
 			
 		
 		
		// 간략 리뷰 
		let sr = "<div class='reviewBox'>";
		$.each(list, function(i, val){

		if(val.del ==0){
			var rContent = val.rContent;
			if(rContent.length > 300){
				rContent = rContent.substring(0,70)+" . . .";
			}
			if(i%2==0 && i!=0 ){
				sr += "</div><div class='reviewBox'>";
			}
			sr += "<div class='reviewItem' >"
		 			+ "<div style='float:left'>"
					+ "<img src="+val.profilePic+" class='reviewImg'>"
					+ "</div>"
					+ "<div style='float:left;'>"
					+	"<div class='reviewId'>"+val.name+"</div>"
					+	"<div class='reviewDate'>"+val.wDate+"</div>"
					+ "</div>"
					+ "<br><br><br>"
					+ "<div class='reviewContent'>"
					+	rContent
					+ "</div>";
			sr 	+= "</div>";
		}
			if(i==5){
				return false; 
			}
		});
		
		sr += "</div>";
		$(".reviewAppend").append(sr);
		 
 	},
	error:function(){
		alert("오류를 잡아라~!");
	}		
});
}


	
	$("#reviewUpSub").hide();

//~~~~~~~~~ 리뷰 수정  ~~~~~~~~~~~~~~
function reviewUp(reviewSeq){
	//alert("리뷰시퀀스" + reviewSeq);
$("#reviewImages").append("<input type='hidden' name='reviewSeq' id='reviewSeq' value=''>");
	$.ajax({
		url:"http://localhost:3000/getReview",
		type: "get",
		data: {reviewSeq:reviewSeq},
		success:function(data){
	//		alert("수정 완료!");
	//		alert(typeof (JSON.stringify(data.satisfy)));
	//		var satisfy = parseInt(data.satisfy)
	//		alert(typeof satisfy )
	//		alert("리뷰시퀀스" + data.reviewSeq);
			//모달로 뿌러줘야하는데.............
			$(".reviewBtn").show();
			
		
			$("#rContent").val(data.rContent); 
			$("#reviewSubmit").hide();	//리뷰 쓰기에 제출 버튼 안보이게해줘
			$("#reviewUpSub").show();	// 리뷰 수정버튼 보이게해줘
			$(".reviewBtn").trigger('click');
			
			
			$("#memNum").val(memNum);
			$("#name").val(userName);
			$("#classNum").val(data.classNum);
			$("#reviewSeq").val(data.reviewSeq);
				$("#reviewUpSub").click(function(){
				//	alert("수정하기 버튼 클릭");
					
					$.ajax({
						url:"http://localhost:3000/updateReview",
						type: "post",
						data: new FormData($("#reviewImages")[0]),  // 필수 
						processData: false, // 필수
						contentType: false, // 필수 
						cache: false,
						success:function(){
						//	alert("수정완료");
							$("#rContent").val("");
							 location.reload();
						},
						error:function(){
							alert('에러야그만보자~');
						}						
						
						
					});//ajax
				});//제출하기버튼
				
			},
		error:function(){
			alert("내이름은 에러^ㅠ^");
		}
	});

}
//~~~~~~리뷰 삭제~~~~~~~~~
function reviewDel(reviewSeq){
	
	$.ajax({
		url:"http://localhost:3000/reviewDel",
		type:"get",
		data:{reviewSeq:reviewSeq},
		success:function(){
			alert("삭제되었습니다.");
			location.reload(true);
		},
		error:function(){
			alert("삭제 오류");
		}
	});
}


//~~~~~~~~수강생 아니면 리뷰작성 막아놈~~~~~~~~~~~~~
 function checkMember(){
	if(login == null){
		$(".reviewBtn").hide();
		return;
	}
	$.ajax({
		url:"http://localhost:3000/checkMember",
		type:"post",
		data:{classNum:seq, memNum:memNum}, 
		success:function( count ){
		//	alert(count);
			if(count == true){
			
			//	alert('true');
				$(".reviewBtn").show();
			}else{

			//	alert('false');
				$(".reviewBtn").hide();
			}
		},
		error:function(){
			alert("리뷰작성가능error");
		}
	});	 
}


// 저장버튼 
function DetailLike (){
	if(login == null){  
		alert('로그인이 필요합니다');
	}
	else{
		if($(".DetailLikeBtn").attr('check')=='no'){
			$(".DetailLikeBtn").css("color", "red");
			$(".DetailLikeBtn").attr('check', 'yes');
			$.ajax({
				url:"http://localhost:3000/addLike",  
				type:"post",
				data:{memNum:memNum, classNum:seq},
				error:function(){
					alert("addLike ajax error");
				}
			});
		}
		else{
			$(".DetailLikeBtn").css("color", "black");
			$(".DetailLikeBtn").attr('check', 'no');
			$.ajax({
				url:"http://localhost:3000/delLike",  
				type:"post",
				data:{memNum:memNum, classNum:seq},
				error:function(){
					alert("delLike ajax error");
				}
			});
		}
	}
}	

// 공유하기
new ClipboardJS('.DetailShareBtn'); 
function DetailShare(){
	let url = window.location.href;
	$(".DetailShareBtn").attr('data-clipboard-text', url);
	alert('주소가 저장 되었습니다');
};





	
</script>
</body>
</html>